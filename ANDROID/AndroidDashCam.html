<!DOCTYPE html>
<html lang="en-US">
<head>
	<link rel="stylesheet" href="../stylesheet.css">
	
        <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../script.js"></script>
	<title>Android: Dash Cam</title>
</head>
<body>
    <div id="background"><img src="androidLanding.png" /></div>
    <div id="textBackground">
    </div>
    <div id="container">
            <div class="content-div">
                <h1 style="text-align:center;">Dash Cam App</h1>
                <img src="recscreen.jpg" /><img src="device-2015-01-14-131619.jpg" />
                <p>
                    After collecting a couple smartphones over the course of time, I came to the
                    conclusion that I should put one to use. I had the idea to turn my old Motorola Photon 4g
                    into a useable dashcam.
                </p><p>
                    The idea was simple; create an app that would have a video 'buffer'
                    which would empty itself or save itself depending on user input. The 'buffer' would be two minute
                    video chucks, currently set to 3 chucks before self-delete takes place. This allows the app to buffer
                    atleast 4 minutes of continous video, plus whatever its currently recording. There were two major challenges
                    that I faced with this app, the 'run in the background' and saving space on the phone by not having a continous
                    video recording.
                </p>
        <div class="space"></div>
                <h2>Challenge One: "Get Back"</h2>
                <p>
                    I needed the dash cam to able to run in the background so I did not have to be in constant focus.
                    This is useful becuase in the future I would like to create another app that will forward
                    google maps data to my Photon so I can also have a dash mounted navigation device. I also
                    wanted to allow the Photon to sleep; usually when the
                    phone is put into sleep any running services are stopped and the CPU is put into a low power
                    state. This forces any running processes in my app to quit, specifically the recording.
                </p>
                <p>
                    The app is designed to run in the background so the recording would continue even after
                    the phone screen was turned off or the user navigated out of the app. This was handled with
                    empty onPause() and onStop() methods. These methods are called when a user navigates away
                    from the app; for example hitting the home button, locking the screen, or the system entering 'sleep'
                    after screen timeout.</p>
                <div class="codeBox"><pre>
                                 <a name="l85"><span class="ln">   </span></a> 
<a name="l86"><span class="ln">   </span></a>    @Override 
<a name="l87"><span class="ln">   </span></a>    </span><span class="s0">protected void </span><span class="s1">onPause(){ 
<a name="l88"><span class="ln">   </span></a>        </span><span class="s0">super</span><span class="s1">.onPause()</span><span class="s0">;</span><span class="s1"> 
<a name="l50"><span class="ln">   </span></a>            </span><span class="s4">//Intentionally left blank for no action.</span><span class="s1"> 
<a name="l89"><span class="ln">   </span></a>    } 
            </pre>
            </div>
        <div class="smallSpace"></div>
            <div class="codeBox">
                <pre>
                    <a name="l114"><span class="ln">  </span></a> 
<a name="l115"><span class="ln">  </span></a>    @Override 
<a name="l116"><span class="ln">  </span></a>    </span><span class="s0">protected void </span><span class="s1">onStop(){ 
<a name="l117"><span class="ln">  </span></a>        </span><span class="s0">super</span><span class="s1">.onStop()</span><span class="s0">;</span><span class="s1"> 
<a name="l118"><span class="ln">  </span></a>        </span><span class="s2">//do nothing if the user exits, we want to keep recording video!</span><span class="s1"> 
<a name="l119"><span class="ln">  </span></a>    } 
<a name="l120"><span class="ln">  </span></a> 
</pre>
            </div>
                         <p>   The main issue with this approach was the fact that the MediaRecorder object
                    was losing its surface when the app recieved calls to onPause() and onStop() because the preview
                    surface that was setup within the onCreate() method when the app is first created, was being destroyed
                    by the operating system. The way to fix this issue was test whether we have the window focus or not.
                    If the user does have focus on our app, then we can load a preview
                    surface and start the recorder. Otherwise, if the user does not have focus on the app, then I start the MediaRecorder
                    without a preview surface. This was causing issues when the MediaRecorder was re-created after the
                    two minute interval and a new instance was setup to record the next two minute chunk.
                </p>
                <h2 style="text-align:center;">Challenge Two: "Save Space"</h2>
                <p>
                    The app is also designed with space constraints in mind. My Photon has an 8 gigabyte internal memory,
                    this would quickly fill up if I allowed the camera to record one continous stream of video. Considering
                    I set the MediaRecorder object to record in full 1080P (or whatever the max of the device is); my files
                    are big, one two-minute recording is in the neighborhood of 180MB, for a two-minute clip, imagine what
                    a 3 hour drive would require! My solution then was to create the video 'buffer' of three files that would
                    continually delete the oldest of the three files when it begins a new recording. This gives me a buffer of
                    roughly 550 MB, which could be lowered as the buffer size is hard coded into the app; which is something
                    I plan to change in the future with a simple number picker or similar input to allow a 'custom' buffer.
                </p>
                    <div class="codeBox"><pre>

<a name="l47"><span class="ln">   </span></a>    </span><span class="s0">public void </span><span class="s1">clean() { 
<a name="l48"><span class="ln">   </span></a>        </span><span class="s4">//keep our buffer count up</span><span class="s1"> 
<a name="l49"><span class="ln">   </span></a>        </span><span class="s0">if</span><span class="s1">(files.size() &gt;= filesToSave) { 
<a name="l50"><span class="ln">   </span></a>            </span><span class="s4">//check for oldest file</span><span class="s1"> 
<a name="l51"><span class="ln">   </span></a>            </span><span class="s0">if </span><span class="s1">(files.get(</span><span class="s5">0</span><span class="s1">).exists()) { 
<a name="l52"><span class="ln">   </span></a>                </span><span class="s0">try </span><span class="s1">{ 
<a name="l53"><span class="ln">   </span></a>                    </span><span class="s4">//delete oldest</span><span class="s1"> 
<a name="l54"><span class="ln">   </span></a>                    files.get(</span><span class="s5">0</span><span class="s1">).delete()</span><span class="s0">;</span><span class="s1"> 
<a name="l55"><span class="ln">   </span></a>                } </span><span class="s0">catch </span><span class="s1">(Exception e) { 
<a name="l56"><span class="ln">   </span></a>                    Log.e(</span><span class="s3">&quot;FileManager&quot;</span><span class="s0">, </span><span class="s1">e.getMessage())</span><span class="s0">;</span><span class="s1"> 
<a name="l57"><span class="ln">   </span></a>                } 
<a name="l58"><span class="ln">   </span></a>            } 
<a name="l59"><span class="ln">   </span></a>            </span><span class="s4">//don't need to track anymore...</span><span class="s1"> 
<a name="l60"><span class="ln">   </span></a>            files.remove(</span><span class="s5">0</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l61"><span class="ln">   </span></a>        } 
<a name="l62"><span class="ln">   </span></a>    } 
</pre><div class="caption">Here I delete the oldest file; 'files' is a static class member ArrayList of type File. 'filesToSave' is a static class member of type int.</div></div>
        <div class="space"></div>
        <h2>Operation:</h2>
        <p>The app uses five classes; a MainActivity.java class that handles everything with the Activity itself, a FileManager.java class that handles all of the <a href="http://developer.android.com/reference/java/io/File.html" target="_blank">File</a>
                 object interactions, a Recorder.java
                class that handles all interactions with the MediaRecorder object, a CameraPreview.java class that handles the SurfaceView interactions of the camera and UI, and a DashCam.java
                class that handles all interactions with the Camera object. The operation is pretty simple, in my onCreate() method the main UI fragment is created and I initialize my DashCamera, FileManager, I also create a ThreadPoolExecutor
                object for the scheduled recordings. I also create a PowerManager object to prevent the phone from entering sleep with the screen off, also capture the AudioManager instance to turn
                off the camera sounds; as Motorola restricted access to this sound to users, there is no way to turn off the camera sound so my app sets the audio to a solo stream state of stream voice call.
                 </p>
        <div class="codeBox">
            <pre>
                <a name="l203"><span class="ln">  </span></a> 
<a name="l204"><span class="ln">  </span></a>    </span><span class="s6">/** 
<a name="l205"><span class="ln">  </span></a>     * A placeholder fragment containing a simple view. 
<a name="l206"><span class="ln">  </span></a>     */</span><span class="s1"> 
<a name="l207"><span class="ln">  </span></a>    </span><span class="s0">public static class </span><span class="s1">PlaceholderFragment </span><span class="s0">extends </span><span class="s1">Fragment { 
<a name="l208"><span class="ln">  </span></a> 
<a name="l209"><span class="ln">  </span></a>        </span><span class="s0">public </span><span class="s1">PlaceholderFragment() { 
<a name="l210"><span class="ln">  </span></a>        } 
<a name="l211"><span class="ln">  </span></a> 
<a name="l212"><span class="ln">  </span></a>        @Override 
<a name="l213"><span class="ln">  </span></a>        </span><span class="s0">public </span><span class="s1">View onCreateView(LayoutInflater inflater</span><span class="s0">, </span><span class="s1">ViewGroup container</span><span class="s0">,</span><span class="s1"> 
<a name="l214"><span class="ln">  </span></a>                                 Bundle savedInstanceState) { 
<a name="l215"><span class="ln">  </span></a>            View rootView = inflater.inflate(R.layout.fragment_main</span><span class="s0">, </span><span class="s1">container</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l216"><span class="ln">  </span></a>            launchButton = (Button) rootView.findViewById(R.id.launchButton)</span><span class="s0">;</span><span class="s1"> 
<a name="l217"><span class="ln">  </span></a>            viewFilesButton = (Button) rootView.findViewById(R.id.viewFilesButton)</span><span class="s0">;</span><span class="s1"> 
<a name="l218"><span class="ln">  </span></a>            previewFrame = (FrameLayout) rootView.findViewById(R.id.previewFrame)</span><span class="s0">;</span><span class="s1"> 
<a name="l219"><span class="ln">  </span></a>            saveButton = (Button) rootView.findViewById(R.id.saveButton)</span><span class="s0">;</span><span class="s1"> 
<a name="l220"><span class="ln"></span></a>            stopSaveButton = (Button) rootView.findViewById(R.id.stopSave)</span><span class="s0">;</span><span class="s1"> 
<a name="l221"><span class="ln"></span></a> 
<a name="l222"><span class="ln"></span></a>            launchButton.setOnClickListener(</span><span class="s0">new </span><span class="s1">View.OnClickListener() { 
<a name="l223"><span class="ln"></span></a>                @Override 
<a name="l224"><span class="ln"></span></a>                </span><span class="s0">public void </span><span class="s1">onClick(View v) { 
<a name="l225"><span class="ln"></span></a>                    launch()</span><span class="s0">;</span><span class="s1"> 
<a name="l226"><span class="ln"></span></a>                } 
<a name="l227"><span class="ln"></span></a>            })</span><span class="s0">;</span><span class="s1"> 
<a name="l228"><span class="ln"></span></a>            viewFilesButton.setOnClickListener(</span><span class="s0">new </span><span class="s1">View.OnClickListener() { 
<a name="l229"><span class="ln"></span></a>                @Override 
<a name="l230"><span class="ln"></span></a>                </span><span class="s0">public void </span><span class="s1">onClick(View v) { 
<a name="l231"><span class="ln"></span></a>                    Toast toast = (Toast.makeText(mainActivity</span><span class="s0">, </span><span class="s4">&quot;Files are saved under Movies in File manager&quot;</span><span class="s0">, </span><span class="s1">Toast.LENGTH_LONG))</span><span class="s0">;</span><span class="s1"> 
<a name="l232"><span class="ln"></span></a>                    toast.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l233"><span class="ln"></span></a>                    Intent getFilesIntent = </span><span class="s0">new </span><span class="s1">Intent()</span><span class="s0">;</span><span class="s1"> 
<a name="l234"><span class="ln"></span></a>                    getFilesIntent.setAction(Intent.ACTION_GET_CONTENT)</span><span class="s0">;</span><span class="s1"> 
<a name="l235"><span class="ln"></span></a>                    getFilesIntent.setType(</span><span class="s4">&quot;file/*&quot;</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l236"><span class="ln"></span></a>                    startActivity(getFilesIntent)</span><span class="s0">;</span><span class="s1"> 
<a name="l237"><span class="ln"></span></a>                } 
<a name="l238"><span class="ln"></span></a>            })</span><span class="s0">;</span><span class="s1"> 
<a name="l239"><span class="ln"></span></a> 
<a name="l240"><span class="ln"></span></a>            saveButton.setOnClickListener(</span><span class="s0">new </span><span class="s1">View.OnClickListener() { 
<a name="l241"><span class="ln"></span></a>                @Override 
<a name="l242"><span class="ln"></span></a>                </span><span class="s0">public void </span><span class="s1">onClick(View v) { 
<a name="l243"><span class="ln"></span></a>                    </span><span class="s0">if</span><span class="s1">(recorder != </span><span class="s0">null</span><span class="s1">){ 
<a name="l244"><span class="ln"></span></a>                        fileManager.saveFiles()</span><span class="s0">;</span><span class="s1"> 
<a name="l245"><span class="ln"></span></a>                    } 
<a name="l246"><span class="ln"></span></a>                } 
<a name="l247"><span class="ln"></span></a>            })</span><span class="s0">;</span><span class="s1"> 
<a name="l248"><span class="ln"></span></a> 
<a name="l249"><span class="ln"></span></a>            stopSaveButton.setOnClickListener(</span><span class="s0">new </span><span class="s1">View.OnClickListener() { 
<a name="l250"><span class="ln"></span></a>                @Override 
<a name="l251"><span class="ln"></span></a>                </span><span class="s0">public void </span><span class="s1">onClick(View v) { 
<a name="l252"><span class="ln"></span></a>                    </span><span class="s0">if</span><span class="s1">(recorder != </span><span class="s0">null</span><span class="s1">){ 
<a name="l253"><span class="ln"></span></a>                        fileManager.clearSave()</span><span class="s0">;</span><span class="s1"> 
<a name="l254"><span class="ln"></span></a>                    } 
<a name="l255"><span class="ln"></span></a>                } 
<a name="l256"><span class="ln"></span></a>            })</span><span class="s0">;</span><span class="s1"> 
<a name="l257"><span class="ln"></span></a>            </span><span class="s0">return </span><span class="s1">rootView</span><span class="s0">;</span><span class="s1"> 
<a name="l258"><span class="ln"></span></a>        } 
<a name="l259"><span class="ln"></span></a>    } 
<a name="l260"><span class="ln"></span></a>} 

</pre><div class="caption">Here is the Fragment creation method called from onCreate(). This method initializes the UI for the app. We see the views being created along with the buttons
                                            that are used for interaction. The 'save' button is used to call a method 'saveFile()' that is within the FileManager class that I created. The 'stopSave' button
                                            is used to call a method 'clearSave()' that was implemented in FileManager class. These two calls are what are used to save or not save the video files.</div>
        </div>
        <p>After the onCreate() is called, Android calls the onStart() and then onResume(). My onStart() method is left empty, and my onResume() is where I start my PowerManager to wake lock
                the phone, set a requested orientation of landscape, and setup the SurfaceView for the Camera. I left onStart() empty as I really have no reason to use this method; the onCreate() is
                called only once during the lifecycle of the app whereas onStart() can be called multiple times by Android depending on circumstances. I only wanted one instance of my app running
                at any time, it would actually fail if two instances were to try to be used becuase Android only allows access to the Camera for one app at a time.</p>
        <div class="codeBox"><pre>
<a name="l54"><span class="ln">   </span></a> 
<a name="l55"><span class="ln">   </span></a>    @Override 
<a name="l56"><span class="ln">   </span></a>    </span><span class="s0">protected void </span><span class="s1">onCreate(Bundle savedInstanceState) { 
<a name="l57"><span class="ln">   </span></a>        </span><span class="s0">super</span><span class="s1">.onCreate(savedInstanceState)</span><span class="s0">;</span><span class="s1"> 
<a name="l58"><span class="ln">   </span></a>        setContentView(R.layout.activity_main)</span><span class="s0">;</span><span class="s1"> 
<a name="l59"><span class="ln">   </span></a>        </span><span class="s0">if </span><span class="s1">(savedInstanceState == </span><span class="s0">null</span><span class="s1">) { 
<a name="l60"><span class="ln">   </span></a>            getSupportFragmentManager().beginTransaction() 
<a name="l61"><span class="ln">   </span></a>                    .add(R.id.container</span><span class="s0">, new </span><span class="s1">PlaceholderFragment()) 
<a name="l62"><span class="ln">   </span></a>                    .commit()</span><span class="s0">;</span><span class="s1"> 
<a name="l63"><span class="ln">   </span></a>        } 
<a name="l64"><span class="ln">   </span></a>        mainActivity = </span><span class="s0">this;</span><span class="s1"> 
<a name="l65"><span class="ln">   </span></a>        </span><span class="s2">//get our custom DashCamera object</span><span class="s1"> 
<a name="l66"><span class="ln">   </span></a>        dashCamera = </span><span class="s0">new </span><span class="s1">DashCamera(mainActivity)</span><span class="s0">;</span><span class="s1"> 
<a name="l68"><span class="ln">   </span></a>        fileManager = </span><span class="s0">new </span><span class="s1">FileManager(</span><span class="s3">3</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l67"><span class="ln">   </span></a>        </span><span class="s2">//get a thread pool for the dashcam operations; request 5 threads</span><span class="s1"> 
<a name="l69"><span class="ln">   </span></a>        cameraThreads = </span><span class="s0">new </span><span class="s1">ScheduledThreadPoolExecutor(</span><span class="s3">5</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l70"><span class="ln">   </span></a>        powerManager = (PowerManager)getSystemService(POWER_SERVICE)</span><span class="s0">;</span><span class="s1"> 
<a name="l71"><span class="ln">   </span></a>        wakeLock = powerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK</span><span class="s0">, </span><span class="s4">&quot;Dash Cam&quot;</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l72"><span class="ln">   </span></a>        audioManager = (AudioManager)getSystemService(Context.AUDIO_SERVICE)</span><span class="s0">;</span><span class="s1"> 
<a name="l73"><span class="ln">   </span></a>        audioManager.setStreamSolo(AudioManager.STREAM_VOICE_CALL</span><span class="s0">, true</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l84"><span class="ln">   </span></a>    } 
<a name="l85"><span class="ln">   </span></a> 
</pre><div class="caption">Here is my onCreate() method. You can see my audio solution along with the Wake Lock setting.</div></div>

        <p>The app launches into my UI where there is a 'Launch Dash Cam' button. This button performs a method 'launch' within my MainActivity. During this method, the first checks if 
                it has already been launched (for the case when someone clicks after it has already started) and exits if it has already been started. If this is a new instance, the app starts the preview
                Surface and adds it to a FrameLayout on the UI so the user can preview thier image. The we create the Recorder object which is a class I created by extending MediaRecorder.
                The object is created at this point becuase it requires a proper Surface to preview to, so it must be created after a Surface is prepared. The creation of the Recorder object is delayed 
                by one second to allow Android time to set the Camera preview and start displaying to the Surface. This delay is only needed during the initial start of Recorder. Then the ThreadPoolExecutor
                object is loaded with my timed DashCamera operations. </p>
        <div class="codeBox">
            <pre>
                <a name="l162"><span class="ln">  </span></a> 
<a name="l163"><span class="ln">  </span></a>    </span><span class="s0">public static void </span><span class="s1">launch(){ 
<a name="l164"><span class="ln">  </span></a>        </span><span class="s2">//make sure we cant 'launch' twice!</span><span class="s1"> 
<a name="l165"><span class="ln">  </span></a>        </span><span class="s0">if</span><span class="s1">(!launched) { 
<a name="l166"><span class="ln">  </span></a>            </span><span class="s2">//add our preview</span><span class="s1"> 
<a name="l167"><span class="ln">  </span></a>            previewFrame.addView(dashCamera.getCameraPreview())</span><span class="s0">;</span><span class="s1"> 
<a name="l168"><span class="ln">  </span></a>            </span><span class="s2">//we need a delay before starting the mediaRecorder to allow views to settle</span><span class="s1"> 
<a name="l169"><span class="ln">  </span></a>            </span><span class="s0">final </span><span class="s1">Handler delay = </span><span class="s0">new </span><span class="s1">Handler()</span><span class="s0">;</span><span class="s1"> 
<a name="l170"><span class="ln">  </span></a>            </span><span class="s2">//postDelay this action, wait 1000ms (1sec)</span><span class="s1"> 
<a name="l171"><span class="ln">  </span></a>            delay.postDelayed(</span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l172"><span class="ln"> </span></a>                @Override 
<a name="l173"><span class="ln">  </span></a>                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l174"><span class="ln">  </span></a>                    </span><span class="s2">//get our surface</span><span class="s1"> 
<a name="l175"><span class="ln">  </span></a>                    previewSurface = dashCamera.getCameraPreview().getSurface()</span><span class="s0">;</span><span class="s1"> 
<a name="l176"><span class="ln">  </span></a>                    recorder = </span><span class="s0">new </span><span class="s1">Recorder(dashCamera</span><span class="s0">, </span><span class="s1">mainActivity</span><span class="s0">, </span><span class="s1">previewSurface)</span><span class="s0">;</span><span class="s1"> 
<a name="l177"><span class="ln">  </span></a>                    recorder.activate()</span><span class="s0">;</span><span class="s1"> 
<a name="l178"><span class="ln">  </span></a>                } 
<a name="l179"><span class="ln">  </span></a>            }</span><span class="s0">, </span><span class="s3">1000</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l180"><span class="ln">  </span></a>            </span><span class="s2">//start the recording!</span><span class="s1"> 
<a name="l181"><span class="ln">  </span></a>            cameraThreads.scheduleAtFixedRate(</span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l182"><span class="ln">  </span></a>                @Override 
<a name="l183"><span class="ln">  </span></a>                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l184"><span class="ln">  </span></a>                    </span><span class="s0">if </span><span class="s1">(recorder.isRunning()) { 
<a name="l185"><span class="ln">  </span></a>                        recorder.deactivate()</span><span class="s0">;</span><span class="s1"> 
<a name="l186"><span class="ln">  </span></a>                    } 
<a name="l187"><span class="ln">  </span></a>                    </span><span class="s2">//start new Recorder</span><span class="s1"> 
<a name="l188"><span class="ln">  </span></a>                    recorder = </span><span class="s0">new </span><span class="s1">Recorder(dashCamera</span><span class="s0">, </span><span class="s1">mainActivity</span><span class="s0">, </span><span class="s1">previewSurface)</span><span class="s0">;</span><span class="s1"> 
<a name="l189"><span class="ln">  </span></a>                    recorder.activate()</span><span class="s0">;</span><span class="s1"> 
<a name="l190"><span class="ln">  </span></a>                    </span><span class="s2">//if we are NOT saving files, clean them up</span><span class="s1"> 
<a name="l191"><span class="ln">  </span></a>                    </span><span class="s0">if </span><span class="s1">(!fileManager.getSaveState()) { 
<a name="l192"><span class="ln">  </span></a>                        fileManager.clean()</span><span class="s0">;</span><span class="s1"> 
<a name="l193"><span class="ln">  </span></a>                    } 
<a name="l194"><span class="ln">  </span></a>                } 
<a name="l195"><span class="ln">  </span></a>            }</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s1">TimeUnit.MINUTES)</span><span class="s0">;</span><span class="s1"> 
<a name="l196"><span class="ln">  </span></a>            launched = </span><span class="s0">true;</span><span class="s1"> 
<a name="l197"><span class="ln">  </span></a>        } 
<a name="l198"><span class="ln">  </span></a>    } 
<a name="l199"><span class="ln">  </span></a> 
</pre><div class="caption">'launched', 'previewFrame', 'dashCamera', 'cameraThreads', and 'recorder' are all static class members. Here we can see the delay of starting the
                                                    Recorder object. We also see the launching of the ThreadPoolExecutor service that will fire our camera automatically for us. Also note the hard-coded
                                                    delay ints, these are the delays that ThreadPoolExecutor waits before executing. These numbers can be changed as they represent the amount of time
                                                    each recording will be. These could be handled with user input in the future.</div>
        </div>
        <p>The app uses the menu bar for the Exit/Quit button. When the user wants to exit the app, they hit the 'menu' button of their phone and a 'Quit' button is the only thing that pops up.
                I used the standard onOptions menu that Android Studio provides with a default app. During the onOptionsItemSelected() method within MainActivity, I ensure the user pressed
                the 'Quit' button and if they did, the app performs a sequence of releasing all resources it is currently useing. The video files within cache or that are currently being recorded will 
                not be saved unless the user has used the 'Save' button during the recording process. If the user wants cache videos saved, along with what is currently being recorded, they must
                exit in a 'Save' state. I plan to add a notification that asks the user specifically this in the future. </p>
        <div class="codeBox">
            <pre>
                <a name="l127"><span class="ln">  </span></a> 
<a name="l128"><span class="ln">  </span></a>    @Override 
<a name="l129"><span class="ln">  </span></a>    </span><span class="s0">public boolean </span><span class="s1">onOptionsItemSelected(MenuItem item) { 
<a name="l130"><span class="ln">  </span></a>        </span><span class="s2">// Handle action bar item clicks here. The action bar will</span><span class="s1"> 
<a name="l131"><span class="ln">  </span></a>        </span><span class="s2">// automatically handle clicks on the Home/Up button, so long</span><span class="s1"> 
<a name="l132"><span class="ln">  </span></a>        </span><span class="s2">// as you specify a parent activity in AndroidManifest.xml.</span><span class="s1"> 
<a name="l133"><span class="ln">  </span></a>        </span><span class="s0">int </span><span class="s1">id = item.getItemId()</span><span class="s0">;</span><span class="s1"> 
<a name="l134"><span class="ln">  </span></a>        </span><span class="s2">//noinspection SimplifiableIfStatement</span><span class="s1"> 
<a name="l135"><span class="ln">  </span></a> 
<a name="l136"><span class="ln">  </span></a>        </span><span class="s2">//exit the app</span><span class="s1"> 
<a name="l137"><span class="ln">  </span></a>        </span><span class="s0">if </span><span class="s1">(id == R.id.action_settings) { 
<a name="l138"><span class="ln">  </span></a>            </span><span class="s0">super</span><span class="s1">.onDestroy()</span><span class="s0">;</span><span class="s1"> 
<a name="l139"><span class="ln">  </span></a>            wakeLock.release()</span><span class="s0">;</span><span class="s1"> 
<a name="l140"><span class="ln">  </span></a>            </span><span class="s2">//free up our resources</span><span class="s1"> 
<a name="l141"><span class="ln">  </span></a>            </span><span class="s0">if</span><span class="s1">(recorder != </span><span class="s0">null</span><span class="s1">){ 
<a name="l142"><span class="ln">  </span></a>                </span><span class="s2">//get rid of Recorder</span><span class="s1"> 
<a name="l143"><span class="ln">  </span></a>                recorder.deactivate()</span><span class="s0">;</span><span class="s1"> 
<a name="l144"><span class="ln">  </span></a>            } 
<a name="l145"><span class="ln">  </span></a>            </span><span class="s0">if</span><span class="s1">(dashCamera.isRunning()) { 
<a name="l146"><span class="ln">  </span></a>                </span><span class="s2">//release our camera</span><span class="s1"> 
<a name="l147"><span class="ln">  </span></a>                dashCamera.deactivate()</span><span class="s0">;</span><span class="s1"> 
<a name="l148"><span class="ln">  </span></a>            } 
<a name="l149"><span class="ln">  </span></a>            </span><span class="s2">//delete cache</span><span class="s1"> 
<a name="l150"><span class="ln">  </span></a>            </span><span class="s0">if</span><span class="s1">(!fileManager.getSaveState()) { 
<a name="l151"><span class="ln">  </span></a>                </span><span class="s2">//delete cache videos</span><span class="s1"> 
<a name="l152"><span class="ln">  </span></a>                fileManager.cleanAll()</span><span class="s0">;</span><span class="s1"> 
<a name="l153"><span class="ln">  </span></a>            } 
<a name="l154"><span class="ln">  </span></a>            </span><span class="s2">//shutdown threads</span><span class="s1"> 
<a name="l155"><span class="ln">  </span></a>            cameraThreads.shutdown()</span><span class="s0">;</span><span class="s1"> 
<a name="l156"><span class="ln">  </span></a>            audioManager.setStreamSolo(AudioManager.STREAM_VOICE_CALL</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l157"><span class="ln">  </span></a>            </span><span class="s2">//GTFO!!</span><span class="s1"> 
<a name="l158"><span class="ln">  </span></a>            System.runFinalizersOnExit(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l158"><span class="ln">  </span></a>            System.exit(</span><span class="s3">0</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l159"><span class="ln">  </span></a>        } 
<a name="l160"><span class="ln">  </span></a>        </span><span class="s0">return super</span><span class="s1">.onOptionsItemSelected(item)</span><span class="s0">;</span><span class="s1"> 
<a name="l161"><span class="ln">  </span></a>    } 
<a name="l162"><span class="ln">  </span></a> 
</pre><div class="caption">Here we see the onOptionsItemSelected() method. This method is called when the user interacts with a 'menu' button. We see my exit procedure along
                                            with a call to System.runFinalizersOnExit(true); this call is made to ensure Android performs proper garbage collection and closing of Objects.</div>
        </div>

        <div class="space"></div>
        <h2>Camera Operation</h2>
        <p>The <a href="http://developer.android.com/reference/android/hardware/Camera.html" target="_blank">Camera</a> is used to obviously record the video. I created a class 'DashCam' to handle all of the events that I needed to perform with the Camera. My DashCam class does not
                extend any classes; instead, when the DashCam object is initialized, I pass an Activity and the constructor saves the passed Activity, I also create a CameraPreview object which
                is another class I created that extends SurfaceHolder.Callback to handle all the Android previewing requirements for the Camera. The constructor then calls the 'open()' method
                within DashCam which setups the Camera for use.</p>
        <div class="codeBox">
            <pre>
                <a name="l20"><span class="ln"></span></a> 
<a name="l21"><span class="ln"></span></a>    </span><span class="s0">public </span><span class="s1">DashCamera(Activity inActivity){ 
<a name="l22"><span class="ln"></span></a>        callingActivity = inActivity</span><span class="s0">;</span><span class="s1"> 
<a name="l23"><span class="ln"></span></a>        cameraPreview = </span><span class="s0">new </span><span class="s1">CameraPreview(inActivity</span><span class="s0">, this</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l24"><span class="ln"></span></a>        open()</span><span class="s0">;</span><span class="s1"> 
<a name="l25"><span class="ln"></span></a>    } 
<a name="l26"><span class="ln"></span></a> 
<a name="l27"><span class="ln"></span></a> 
<a name="l28"><span class="ln"></span></a> 
<a name="l29"><span class="ln"></span></a>    </span><span class="s0">public static boolean </span><span class="s1">open(){ 
<a name="l30"><span class="ln"></span></a>        </span><span class="s0">if</span><span class="s1">(isOpen) 
<a name="l31"><span class="ln"></span></a>            </span><span class="s0">return true;</span><span class="s1"> 
<a name="l32"><span class="ln"></span></a>        </span><span class="s0">try</span><span class="s1">{ 
<a name="l33"><span class="ln"></span></a>            camera = android.hardware.Camera.open()</span><span class="s0">;</span><span class="s1"> 
<a name="l34"><span class="ln"></span></a>            Camera.Parameters parameters = camera.getParameters()</span><span class="s0">;</span><span class="s1"> 
<a name="l35"><span class="ln"></span></a>            parameters.set(</span><span class="s3">&quot;cam_mode&quot;</span><span class="s0">,</span><span class="s4">1</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l36"><span class="ln"></span></a>            parameters.setPreviewSize(</span><span class="s4">1920</span><span class="s0">, </span><span class="s4">1080</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l37"><span class="ln"></span></a>            parameters.setWhiteBalance(Camera.Parameters.WHITE_BALANCE_AUTO)</span><span class="s0">;</span><span class="s1"> 
<a name="l38"><span class="ln"></span></a>            parameters.setAntibanding(Camera.Parameters.ANTIBANDING_AUTO)</span><span class="s0">;</span><span class="s1"> 
<a name="l39"><span class="ln"></span></a>            parameters.setFocusMode(Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO)</span><span class="s0">;</span><span class="s1"> 
<a name="l40"><span class="ln"></span></a>            camera.setParameters(parameters)</span><span class="s0">;</span><span class="s1"> 
<a name="l41"><span class="ln"></span></a>        }</span><span class="s0">catch </span><span class="s1">(</span><span class="s0">final </span><span class="s1">Exception e){ 
<a name="l42"><span class="ln"></span></a>            Runnable runnable = </span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l43"><span class="ln"></span></a>                @Override 
<a name="l44"><span class="ln"></span></a>                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l45"><span class="ln"></span></a>                    Toast toast = (Toast.makeText(callingActivity</span><span class="s0">, </span><span class="s3">&quot;Problem with DashCam1: &quot; </span><span class="s1">+ e.getMessage()</span><span class="s0">, </span><span class="s1">Toast.LENGTH_LONG))</span><span class="s0">;</span><span class="s1"> 
<a name="l46"><span class="ln"></span></a>                    toast.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l47"><span class="ln"></span></a>                    e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l48"><span class="ln"></span></a>                } 
<a name="l49"><span class="ln"></span></a>            }</span><span class="s0">;</span><span class="s1"> 
<a name="l50"><span class="ln"></span></a>            callingActivity.runOnUiThread(runnable)</span><span class="s0">;</span><span class="s1"> 
<a name="l51"><span class="ln"></span></a>        } 
<a name="l52"><span class="ln"></span></a>        isOpen = </span><span class="s0">true;</span><span class="s1"> 
<a name="l53"><span class="ln"></span></a>        </span><span class="s0">return true;</span><span class="s1"> 
<a name="l54"><span class="ln"></span></a>    } 
<a name="l55"><span class="ln"></span></a> 
</pre><div class="caption">Here we see the DashCam constructor and the 'open()' method. The open() method was kept public for future use/changes.</div>
        </div>
        <p>The Camera is opened in the 'open()' method along with setting all of the Parameters of the Camera the ("cam_mode", 1) is used to set the camera into its
   hd operating mode. i then set a preview size of 1080p, turn on the auto white balance, antibanding to auto which helps reduce 'blurry' lines, and finally set a
   continous focus mode.</p>
        <p>The DashCam class also provides methods for shutting down the Camera, starting and stopping the preview, and lock/unlock operations. When the Camera is
                set to shutdown, I call 'deactivate()' on the DashCam object, this locks the Camera, stops the preview, and releases the Camera back to Android.</p>
        <div class="codeBox">
            <pre>
                <a name="l132"><span class="ln"></span></a> 
<a name="l133"><span class="ln"></span></a>    </span><span class="s0">public void </span><span class="s1">deactivate() { 
<a name="l134"><span class="ln"></span></a>        </span><span class="s0">if</span><span class="s1">(isUnlocked()) 
<a name="l135"><span class="ln"></span></a>            lock()</span><span class="s0">;</span><span class="s1"> 
<a name="l136"><span class="ln"></span></a>        </span><span class="s0">if</span><span class="s1">(isPreview()) 
<a name="l137"><span class="ln"></span></a>            stopPreview()</span><span class="s0">;</span><span class="s1"> 
<a name="l138"><span class="ln"></span></a>        </span><span class="s0">if</span><span class="s1">(isOpen()) 
<a name="l139"><span class="ln"></span></a>            camera.release()</span><span class="s0">;</span><span class="s1"> 
<a name="l140"><span class="ln"></span></a>        isOpen = </span><span class="s0">false;</span><span class="s1"> 
<a name="l141"><span class="ln"></span></a>        isUnlocked = </span><span class="s0">false;</span><span class="s1"> 
<a name="l142"><span class="ln"></span></a>        isPreview = </span><span class="s0">false;</span><span class="s1"> 
<a name="l143"><span class="ln"></span></a>    } 
<a name="l144"><span class="ln"></span></a> 
</pre><div class="caption"></div>
        </div>

        
        <div class="space"></div>
        <h2>File Operation</h2>
        <p>Managing the files of the app was accomplished with the FileManager class that I created. My FileManager class does not extend or implement any classes; instead, I create
                 an ArrayList of type <a href="http://developer.android.com/reference/java/io/File.html" target="_blank">File</a> inside the constructor for FileManager. i also initialize the 'buffer' size within the constructor, this is done by an integer that is passed to the constructor.
   the buffer size tells filemanager class how many video files we should save before we start deleting cache files.</p>
        <div class="codeBox">
            <pre>
                <a name="l19"><span class="ln">   </span></a> 
<a name="l20"><span class="ln"></span></a>    </span><span class="s0">public </span><span class="s1">FileManager(</span><span class="s0">int </span><span class="s1">inFilesToSave){ 
<a name="l21"><span class="ln"></span></a>        files = </span><span class="s0">new </span><span class="s1">ArrayList&lt;File&gt;()</span><span class="s0">;</span><span class="s1"> 
<a name="l22"><span class="ln"></span></a>        filesToSave = inFilesToSave</span><span class="s0">;</span><span class="s1"> 
<a name="l23"><span class="ln"></span></a>    } 
<a name="l24"><span class="ln"></span></a> 
</pre><div class="caption">Both of these members are static class members of FileManager. 'files' stores an ArrayList of Files, while 'filesToSave' lets us know how many videos to save
                                            before it start deleting the 'old' ones.</div>
        </div>
        <p>This class is responsible for handling the creation/deletion of video files created. As we create videos; e.g. when we stop and restart the Recorder we create a new video file, 
                we call to open a new file which gets put into the ArrayList. We then check that our buffer is full, when we have reached our 'filesToSave' value we begin removing the oldest 
                (index 0) file from the ArrayList and making a call to delete() the file from the system. We also implement two methods: saveFiles() and clearSave(), which when called, sets
                a static class boolean value that indicates whether the user wants to save thier files or not (default of false). We then implement the methods: clean() and cleanAll(), these calls 
                delete files from the FileManager. 'clean()' is used to clear the oldest file from the buffer after checking if our buffer is full. 'cleanAll()' is used to remove all files from the buffer.</p>
        <div class="codeBox">
            <pre>

<a name="l73"><span class="ln">   </span></a>    </span><span class="s0">public void </span><span class="s1">saveFiles(){ 
<a name="l74"><span class="ln"></span></a>        </span><span class="s4">//purge file array so we dont delete anything in the future</span><span class="s1"> 
<a name="l75"><span class="ln"></span></a>        files.clear()</span><span class="s0">;</span><span class="s1"> 
<a name="l76"><span class="ln"></span></a>        saveFiles = </span><span class="s0">true;</span><span class="s1"> 
<a name="l77"><span class="ln"></span></a>    } 
<a name="l78"><span class="ln"></span></a>    </span><span class="s0">public void </span><span class="s1">clearSave(){ 
<a name="l79"><span class="ln"></span></a>        </span><span class="s4">//purge file array so we don't delete anything in the future</span><span class="s1"> 
<a name="l80"><span class="ln"></span></a>        </span><span class="s4">//also to save any files that were created while saveFiles = true;</span><span class="s1"> 
<a name="l81"><span class="ln"></span></a>        files.clear()</span><span class="s0">;</span><span class="s1"> 
<a name="l82"><span class="ln"></span></a>        saveFiles = </span><span class="s0">false;</span><span class="s1"> 
<a name="l83"><span class="ln"></span></a>    } 

</pre><div class="caption">Here are the saveFiles() and clearSave() methods used to indicate whether the user wants to save files.</div>
        </div>
        <div class="smallSpace"></div>
        <div class="codeBox">
            <pre>
                
<a name="l47"><span class="ln">47   </span></a>    </span><span class="s0">public void </span><span class="s1">clean() { 
<a name="l48"><span class="ln">48   </span></a>        </span><span class="s4">//keep our buffer count up</span><span class="s1"> 
<a name="l49"><span class="ln">49   </span></a>        </span><span class="s0">if</span><span class="s1">(files.size() &gt;= filesToSave) { 
<a name="l50"><span class="ln">50   </span></a>            </span><span class="s4">//check for oldest file</span><span class="s1"> 
<a name="l51"><span class="ln">51   </span></a>            </span><span class="s0">if </span><span class="s1">(files.get(</span><span class="s5">0</span><span class="s1">).exists()) { 
<a name="l52"><span class="ln">52   </span></a>                </span><span class="s0">try </span><span class="s1">{ 
<a name="l53"><span class="ln">53   </span></a>                    </span><span class="s4">//delete oldest</span><span class="s1"> 
<a name="l54"><span class="ln">54   </span></a>                    files.get(</span><span class="s5">0</span><span class="s1">).delete()</span><span class="s0">;</span><span class="s1"> 
<a name="l55"><span class="ln">55   </span></a>                } </span><span class="s0">catch </span><span class="s1">(Exception e) { 
<a name="l56"><span class="ln">56   </span></a>                    Log.e(</span><span class="s3">&quot;FileManager&quot;</span><span class="s0">, </span><span class="s1">e.getMessage())</span><span class="s0">;</span><span class="s1"> 
<a name="l57"><span class="ln">57   </span></a>                } 
<a name="l58"><span class="ln">58   </span></a>            } 
<a name="l59"><span class="ln">59   </span></a>            </span><span class="s4">//don't need to track anymore...</span><span class="s1"> 
<a name="l60"><span class="ln">60   </span></a>            files.remove(</span><span class="s5">0</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l61"><span class="ln">61   </span></a>        } 
<a name="l62"><span class="ln">62   </span></a>    } 
<a name="l63"><span class="ln">63   </span></a>    </span><span class="s0">public void </span><span class="s1">cleanAll() { 
<a name="l64"><span class="ln">64   </span></a>        </span><span class="s0">for</span><span class="s1">(</span><span class="s0">int </span><span class="s1">i=</span><span class="s5">0</span><span class="s0">; </span><span class="s1">i&lt;files.size()</span><span class="s0">; </span><span class="s1">i++) { 
<a name="l65"><span class="ln">65   </span></a>            </span><span class="s0">if</span><span class="s1">(files.get(i).exists()){ 
<a name="l66"><span class="ln">66   </span></a>                </span><span class="s0">try</span><span class="s1">{ 
<a name="l67"><span class="ln">67   </span></a>                    files.get(i).delete()</span><span class="s0">;</span><span class="s1"> 
<a name="l68"><span class="ln">68   </span></a>                }</span><span class="s0">catch </span><span class="s1">(Exception e){} 
<a name="l69"><span class="ln">69   </span></a>            } 
<a name="l70"><span class="ln">70   </span></a>        } 
<a name="l71"><span class="ln">71   </span></a>        files.clear()</span><span class="s0">;</span><span class="s1"> 
<a name="l72"><span class="ln">72   </span></a>    } 

</pre><div class="caption">Here we see the clean() and cleanAll() methods used to handle deletion of video files.</div>
        </div>


        <div class="space"></div>
        <h2>MediaRecorder Operations</h2>
        <p>The Recorder class that I created extends <a href="http://developer.android.com/reference/android/media/MediaRecorder.html" target="_blank">MediaRecorder</a>. This allows me to inherit
                the properties of MediaRecorder while also being able to implement my own methods that I needed. My recorder class handles the opening and acquiring of DashCam video; 
                so my MediaRecorder had to incorporate some specific methods that would allow such an object. My Recorder class has a constructor that expects a DashCam object, an
                Activity, and a Surface for previewing. During the constructor method the three passed objects are stored as class members and we also initialize a boolean value that lets us
                know if the Recorder is currently 'running' or not. </p>
        <p>The Recorder incorporates two important methods; 'activate()' and 'deactivate()'. The 'activate()' method is used to open the DashCam object, start DashCam preview, and unlock the
                DashCam. If we were able to open and unlock the DashCam, we set the recording preferences and begin recording a video file. </p>
        <div class="codeBox">
            <pre>
<a name="l25"><span class="ln"></span></a>    </span><span class="s0">public void </span><span class="s1">activate() { 
<a name="l26"><span class="ln"></span></a>        </span><span class="s0">if</span><span class="s1">(camera.open()) { 
<a name="l27"><span class="ln"></span></a>                camera.startPreview()</span><span class="s0">;</span><span class="s1"> 
<a name="l28"><span class="ln"></span></a>            </span><span class="s0">if </span><span class="s1">(camera.unlock()) { 
<a name="l29"><span class="ln"></span></a>                </span><span class="s0">try </span><span class="s1">{ 
<a name="l30"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.setCamera(camera.getCamera())</span><span class="s0">;</span><span class="s1"> 
<a name="l31"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.setAudioSource(MediaRecorder.AudioSource.MIC)</span><span class="s0">;</span><span class="s1"> 
<a name="l32"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.setVideoSource(MediaRecorder.VideoSource.CAMERA)</span><span class="s0">;</span><span class="s1"> 
<a name="l33"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.setProfile(CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH))</span><span class="s0">;</span><span class="s1"> 
<a name="l34"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.setOutputFile(FileManager.getOutputMediaFile(MEDIA_TYPE_VIEDO).getAbsolutePath())</span><span class="s0">;</span><span class="s1"> 
<a name="l35"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.prepare()</span><span class="s0">;</span><span class="s1"> 
<a name="l36"><span class="ln"></span></a>                    </span><span class="s0">this</span><span class="s1">.start()</span><span class="s0">;</span><span class="s1"> 
<a name="l37"><span class="ln"></span></a>                    isRunning = </span><span class="s0">true;</span><span class="s1"> 
<a name="l38"><span class="ln"></span></a>                } </span><span class="s0">catch </span><span class="s1">(</span><span class="s0">final </span><span class="s1">Exception e) { 
<a name="l39"><span class="ln"></span></a>                    Runnable runnable = </span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l40"><span class="ln"></span></a>                        @Override 
<a name="l41"><span class="ln"></span></a>                        </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l42"><span class="ln"></span></a>                            Toast toast1 = (Toast.makeText(callingActivity</span><span class="s0">, </span><span class="s4">&quot;Problem with Recorder!&quot; </span><span class="s1">+ e.getMessage()</span><span class="s0">, </span><span class="s1">Toast.LENGTH_LONG))</span><span class="s0">;</span><span class="s1"> 
<a name="l43"><span class="ln"></span></a>                            toast1.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l44"><span class="ln"></span></a>                            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l45"><span class="ln"></span></a>                            deactivate()</span><span class="s0">;</span><span class="s1"> 
<a name="l46"><span class="ln"></span></a>                        } 
<a name="l47"><span class="ln"></span></a>                    }</span><span class="s0">;</span><span class="s1"> 
<a name="l48"><span class="ln"></span></a>                    callingActivity.runOnUiThread(runnable)</span><span class="s0">;</span><span class="s1"> 
<a name="l49"><span class="ln"></span></a>                    isRunning = </span><span class="s0">false;</span><span class="s1"> 
<a name="l50"><span class="ln"></span></a> 
<a name="l51"><span class="ln"></span></a>                } 
<a name="l52"><span class="ln"></span></a> 
<a name="l53"><span class="ln"></span></a>            } 
<a name="l54"><span class="ln"></span></a> 
<a name="l55"><span class="ln"></span></a>        } 
<a name="l56"><span class="ln"></span></a> 
<a name="l57"><span class="ln"></span></a>    } 
</pre>
        </div>
        <p>Recorder class also has 'deactivate()' which finishes the recording of the video file and closes the MediaRecorder object that was created in 'activate()'.
                This important becuase if the MediaRecorder object is not shutdown properly we get video file errors.</p>
        <div class="codeBox">
            <pre>
                 
<a name="l58"><span class="ln"></span></a>    </span><span class="s0">public void </span><span class="s1">deactivate() { 
<a name="l59"><span class="ln"></span></a>        </span><span class="s0">if</span><span class="s1">(isRunning){ 
<a name="l60"><span class="ln"></span></a>            </span><span class="s0">try </span><span class="s1">{ 
<a name="l61"><span class="ln"></span></a>                </span><span class="s0">this</span><span class="s1">.stop()</span><span class="s0">;</span><span class="s1"> 
<a name="l62"><span class="ln"></span></a>                </span><span class="s0">this</span><span class="s1">.reset()</span><span class="s0">;</span><span class="s1"> 
<a name="l63"><span class="ln"></span></a>                </span><span class="s0">this</span><span class="s1">.release()</span><span class="s0">;</span><span class="s1"> 
<a name="l64"><span class="ln"></span></a>                </span><span class="s0">this</span><span class="s1">.isRunning = </span><span class="s0">false;</span><span class="s1"> 
<a name="l65"><span class="ln"></span></a>            }</span><span class="s0">catch </span><span class="s1">(</span><span class="s0">final </span><span class="s1">Exception e){ 
<a name="l66"><span class="ln"></span></a>                Runnable runnable = </span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l67"><span class="ln"></span></a>                    @Override 
<a name="l68"><span class="ln"></span></a>                    </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l69"><span class="ln"></span></a>                        Toast toast1 = (Toast.makeText(callingActivity</span><span class="s0">, </span><span class="s4">&quot;Problem with Recorder2&quot; </span><span class="s1">+ e.getMessage()</span><span class="s0">, </span><span class="s1">Toast.LENGTH_LONG))</span><span class="s0">;</span><span class="s1"> 
<a name="l70"><span class="ln"></span></a>                        toast1.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l71"><span class="ln"></span></a>                        e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l72"><span class="ln"></span></a>                    } 
<a name="l73"><span class="ln"></span></a>                }</span><span class="s0">;</span><span class="s1"> 
<a name="l74"><span class="ln"></span></a>                callingActivity.runOnUiThread(runnable)</span><span class="s0">;</span><span class="s1"> 
<a name="l75"><span class="ln"></span></a>            } 
<a name="l76"><span class="ln"></span></a>        } 
<a name="l77"><span class="ln"></span></a>    } 
<a name="l78"><span class="ln"></span></a> 
</pre>
        </div>
        <div class="space">    </div>
        <h2>Conclusion</h2>
        <p>The DashCam app was really alot of fun to build, I am also please with how it turned out. My Photon 4G is no longer sitting around collecting dust! There are a few
                things that I would like to change with the app. One such thing is asking about file deletion on every exit, this is a feature I did not get around to yet, perhaps I will update
                this page when I do. Another thing with the app is that the calls to android.hardware.Camera are considered depreciated, this is becuase the implementation is different in the
                newer Android OS versions. The Photon 4g runs Android 2.3.4, (API 10), which requires such calls. I would like add check in the app that would allow it to run on the newer
                Android OS (it may as-is I did not check as of writing this). Also the preview is rotated when the user exits the app and comes back; the preview surface is rotated 90 degrees, 
                this is something I am working on currently.</p>
                <p style="text-align:center;">
                    <a href="https://github.com/dusanders/dusanders.github.io/tree/master/ANDROID/Source/DashCam/CameraPreview.java" target="_blank">Download CameraPreview.java</a>
                </p>
                <p style="text-align:center;">
                    <a href="https://github.com/dusanders/dusanders.github.io/tree/master/ANDROID/Source/DashCam/DashCamera.java" target="_blank">Download DashCamera.java</a>
                </p>
                <p style="text-align:center;">
                    <a href="https://github.com/dusanders/dusanders.github.io/tree/master/ANDROID/Source/DashCam/FileManager.java" target="_blank">Download FileManager.java</a>
                </p>
                <p style="text-align:center;">
                    <a href="https://github.com/dusanders/dusanders.github.io/tree/master/ANDROID/Source/DashCam/MainActivity.java" target="_blank">Download MainActivity.java</a>
                </p>
                <p style="text-align:center;">
                    <a href="https://github.com/dusanders/dusanders.github.io/tree/master/ANDROID/Source/DashCam/Recorder.java" target="_blank">Download Recorder.java</a>
                </p>
                <p style="text-align:center;">
                    <a href="https://github.com/dusanders/dusanders.github.io/tree/master/ANDROID/Source/DashCam/" target="_blank">View Source Files Folder</a>
                </p>
                <div id="footer">
			<div id="copyright">
			<p>Copyright &copy; 2015 Dustin Anderson</p>
			</div>
            <div id="aboutButton">
                <p><a href="../index.html">About</a></p>
            </div>
        </div>
            </div><!--end contentdiv-->
        <div id="sideBar">
            <ul id="sideBarList">
                <p style="text-align:center; text-decoration:underline;">Projects</p>
                <li class="sideBarItem" id="RingerWrangler"><a href="AndroidRingerWrangler.html">Ringer Wrangler</a></li>
                <li class="sideBarItem" id="DashCam" style="color: #006600; cursor:default;">Dash Cam</li>
                <li class="sideBarItem" id="BluetoothRc"><a href="AndroidBTLERC.html">BTLE RC Car</a></li>
                <li class="sideBarItem" id="BluetoothShare"><a href="AndroidSensorApp.html">Sensor App</a></li>
            </ul>
        </div>
        <div id="menuBar">
            <ul id="menuList">
                <li class="menuItem"><a href="../CPP/CPP.html">C++</a></li>
                <li class="menuItem"><a href="../CSHARP/CSharp.html">C#</a></li>
                <li class="menuItem"><a href="../JAVA/Java.html">Java</a></li>
                <li class="menuItem"><a href="../ASM/ASM.html">Embedded Systems</a></li>
                <li class="menuItem" style="color: #80CC80;">Android</li>
            </ul>
        </div>
    </div><!--end container-->
</body>

</html>
