<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta name="keywords" content="C,C++,C#,embedded,Embedded,Java,Java SE">
    <meta name="description" content="Examples of code written in C, C++, C#, ASM, JAVA. Along with examples of embedded systems and programming.">
    <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1"> 
    <link rel="stylesheet" href="../stylesheet.css">

    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../script.js"></script>
    <title>Sensor App</title>
</head>
<body>
    <div id="background"><img src="androidLanding.png" /></div>
    <div id="textBackground">
    </div>
    <div id="container">
        <div id="contentdiv">
            <div id="DashCamDiv" class="content-div">
                <h1 style="text-align:center;">Sensor App</h1>
            <div><img src="device-2015-01-14-131537.jpg" /><img src="device-2015-01-14-132208.jpg"</div>
                <p>
                    During the initial conception of my Bluetooth RC Car project I looked up the Android sensors available on my Photon 4G smartphone. This led to creating a small app
                that would allow me to experiment with the various sensors onboard the phone. The app was just a fun thing I threw together while learning how to interact with sensors and
                thier respective events, and how to handle these events. The app is also Bluetooth Classic capable as I was also learning Bluetooth interactions with the app. The development
                also taught me alot about ListView objects and how to properly load them with my own objects. </p>
            <div class="smallSpace"></div>
            <h2>Starting Procedure</h2>
            <p>The basic starting procedure of the app is as follows; we gather any saved Bluetooth devices from the <a href="http://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html" target="_blank">BluetoothAdapter</a> 
                and save these into an ArrayList. We then ask permission of the user if they would like to enable Bluetooth and allow the phone to be discoverable. This then leads
                to the phone scanning for any devices that may not have been saved prior. This is all done by a seperate thread then the UI thread, which makes the app user friendly 
                as the scanning process is a blocking process which would 'freeze' our UI. We then populate the various Views needed by the main UI. </p>
            <div class="codeBox">
                <pre>
<a name="l55"><span class="ln">55   </span></a>    @Override 
<a name="l56"><span class="ln">56   </span></a>    </span><span class="s0">protected void </span><span class="s1">onCreate(Bundle savedInstanceState) { 
<a name="l57"><span class="ln">57   </span></a>        </span><span class="s0">super</span><span class="s1">.onCreate(savedInstanceState)</span><span class="s0">;</span><span class="s1"> 
<a name="l58"><span class="ln">58   </span></a>        </span><span class="s3">//get our Activity information</span><span class="s1"> 
<a name="l59"><span class="ln">59   </span></a>        mainContext = </span><span class="s0">this;</span><span class="s1"> 
<a name="l60"><span class="ln">60   </span></a>        bluetoothDeviceList = </span><span class="s0">new </span><span class="s1">ArrayList&lt;BluetoothDevice&gt;()</span><span class="s0">;</span><span class="s1"> 
<a name="l61"><span class="ln">61   </span></a>        </span><span class="s3">//get our BlueTooth adapter</span><span class="s1"> 
<a name="l62"><span class="ln">62   </span></a>        bluetoothAdapter = BluetoothAdapter.getDefaultAdapter()</span><span class="s0">;</span><span class="s1"> 
<a name="l63"><span class="ln">63   </span></a>        </span><span class="s0">if</span><span class="s1">(!bluetoothAdapter.isEnabled()) { 
<a name="l64"><span class="ln">64   </span></a>            Intent getBluetoothEnable = </span><span class="s0">new </span><span class="s1">Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE)</span><span class="s0">;</span><span class="s1"> 
<a name="l65"><span class="ln">65   </span></a>            startActivity(getBluetoothEnable)</span><span class="s0">;</span><span class="s1"> 
<a name="l66"><span class="ln">66   </span></a>        } 
<a name="l67"><span class="ln">67   </span></a>        </span><span class="s3">//enable discoverable</span><span class="s1"> 
<a name="l68"><span class="ln">68   </span></a>        Intent enableBluetoothDiscoverable = </span><span class="s0">new </span><span class="s1">Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE)</span><span class="s0">;</span><span class="s1"> 
<a name="l69"><span class="ln">69   </span></a>        startActivity(enableBluetoothDiscoverable)</span><span class="s0">;</span><span class="s1"> 
<a name="l70"><span class="ln">70   </span></a>        bluetoothController = </span><span class="s0">new </span><span class="s1">BluetoothController(mainContext</span><span class="s0">, </span><span class="s1">bluetoothAdapter)</span><span class="s0">;</span><span class="s1"> 
<a name="l71"><span class="ln">71   </span></a>        sensorController.setBluetoothController(bluetoothController)</span><span class="s0">;</span><span class="s1"> 
<a name="l72"><span class="ln">72   </span></a>        bluetoothController.discover()</span><span class="s0">;</span><span class="s1"> 
<a name="l73"><span class="ln">73   </span></a>        </span><span class="s3">//get all the views</span><span class="s1"> 
<a name="l74"><span class="ln">74   </span></a>        xView = (TextView)findViewById(R.id.xView)</span><span class="s0">;</span><span class="s1"> 
<a name="l75"><span class="ln">75   </span></a>        yView = (TextView)findViewById(R.id.yView)</span><span class="s0">;</span><span class="s1"> 
<a name="l76"><span class="ln">76   </span></a>        zView = (TextView)findViewById(R.id.zView)</span><span class="s0">;</span><span class="s1"> 
<a name="l77"><span class="ln">77   </span></a>        setContentView(R.layout.activity_main)</span><span class="s0">;</span><span class="s1"> 
<a name="l78"><span class="ln">78   </span></a>        listView = (ListView)findViewById(R.id.listView)</span><span class="s0">;</span><span class="s1"> 
<a name="l79"><span class="ln">79   </span></a>        bluetoothView = (ListView)findViewById(R.id.bluetoothListView)</span><span class="s0">;</span><span class="s1"> 
<a name="l80"><span class="ln">80   </span></a>        mSensorManager = (SensorManager)getSystemService(Context.SENSOR_SERVICE)</span><span class="s0">;</span><span class="s1"> 
<a name="l81"><span class="ln">81   </span></a>        mSensor = mSensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)</span><span class="s0">;</span><span class="s1"> 
<a name="l82"><span class="ln">82   </span></a> 
<a name="l83"><span class="ln">83   </span></a>        </span><span class="s3">//put everything together....</span><span class="s1"> 
<a name="l84"><span class="ln">84   </span></a>        updateView()</span><span class="s0">;</span><span class="s1"> 
<a name="l85"><span class="ln">85   </span></a>        </span><span class="s3">//now that we have a list, setup a click listener</span><span class="s1"> 
<a name="l86"><span class="ln">86   </span></a>        listView.setOnItemClickListener(</span><span class="s0">new </span><span class="s1">AdapterView.OnItemClickListener() { 
<a name="l87"><span class="ln">87   </span></a>            @Override 
<a name="l88"><span class="ln">88   </span></a>            </span><span class="s0">public void </span><span class="s1">onItemClick(AdapterView&lt;?&gt; adapterView</span><span class="s0">, </span><span class="s1">View view</span><span class="s0">, int </span><span class="s1">i</span><span class="s0">, long </span><span class="s1">l) { 
<a name="l89"><span class="ln">89   </span></a>                </span><span class="s3">//get the sensor that was clicked....</span><span class="s1"> 
<a name="l90"><span class="ln">90   </span></a>                Sensor sensor = (Sensor)adapterView.getAdapter().getItem(i)</span><span class="s0">;</span><span class="s1"> 
<a name="l91"><span class="ln">91   </span></a>                </span><span class="s3">//unreg any previous listeners</span><span class="s1"> 
<a name="l92"><span class="ln">92   </span></a>                mSensorManager.unregisterListener(sensorController)</span><span class="s0">;</span><span class="s1"> 
<a name="l93"><span class="ln">93   </span></a>                </span><span class="s3">//reset the sensor listener to the selected one....</span><span class="s1"> 
<a name="l94"><span class="ln">94   </span></a>                mSensorManager.registerListener(sensorController</span><span class="s0">, </span><span class="s1">sensor</span><span class="s0">, </span><span class="s1">SensorManager.SENSOR_DELAY_UI)</span><span class="s0">;</span><span class="s1"> 
<a name="l95"><span class="ln">95   </span></a>            }</span><span class="s3">//end onItemClick</span><span class="s1"> 
<a name="l96"><span class="ln">96   </span></a>        })</span><span class="s0">;</span><span class="s3">//end setOnItemClickListener</span><span class="s1"> 
<a name="l97"><span class="ln">97   </span></a> 
<a name="l98"><span class="ln">98   </span></a>        bluetoothView.setOnItemClickListener(</span><span class="s0">new </span><span class="s1">AdapterView.OnItemClickListener() { 
<a name="l99"><span class="ln">99   </span></a>            @Override 
<a name="l100"><span class="ln">100  </span></a>            </span><span class="s0">public void </span><span class="s1">onItemClick(AdapterView&lt;?&gt; adapterView</span><span class="s0">, </span><span class="s1">View view</span><span class="s0">, int </span><span class="s1">i</span><span class="s0">, long </span><span class="s1">l) { 
<a name="l101"><span class="ln">101  </span></a>                bluetoothController.disconnect()</span><span class="s0">;</span><span class="s1"> 
<a name="l102"><span class="ln">102  </span></a>                Toast toast = Toast.makeText(mainContext</span><span class="s0">, </span><span class="s2">&quot;Disconnect&quot;</span><span class="s0">, </span><span class="s1">Toast.LENGTH_SHORT)</span><span class="s0">;</span><span class="s1"> 
<a name="l103"><span class="ln">103  </span></a>                toast.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l104"><span class="ln">104  </span></a>            } 
<a name="l105"><span class="ln">105  </span></a>        })</span><span class="s0">;</span><span class="s1"> 
<a name="l106"><span class="ln">106  </span></a>    }</span><span class="s3">//end onCreate()</span><span class="s1"> 
<a name="l107"><span class="ln">107  </span></a> 
</pre><div class="caption">This is the onCreate() method of the app, the call to bluetoothController.discover() is launched in a new thread within that method so the
                Bluetooth scanning process does not 'freeze' our UI.</div>
            </div>
            <div class="space"></div>
                <h2>Listing Objects</h2>
                <p>
                    The Motorola Photon 4G comes with quite a few sensors from the factory; such as, 3-axix accelerometer, proximity sensor, orientation sensor, magnetic field sensor, etc. 
                    So to display all of sensors to the user I made a custom class by extending 
                <a href="http://developer.android.com/reference/android/widget/ListAdapter.html" target="_blank">ListAdapter</a> class. This was done to handle the listing of sensors, and
                the listing of any found Bluetooth devices. When the onCreate() method calls updateView(), the updateView() method gathers data from the custom ListAdapter classes and 
                populates my ListViews.</p>
            <div class="codeBox">
                <pre>
<a name="l107"><span class="ln">107  </span></a> 
<a name="l108"><span class="ln">108  </span></a>    </span><span class="s0">public void </span><span class="s1">updateView() 
<a name="l109"><span class="ln">109  </span></a>    { 
<a name="l110"><span class="ln">110  </span></a>        </span><span class="s3">//get our sensors</span><span class="s1"> 
<a name="l111"><span class="ln">111  </span></a>        List&lt;Sensor&gt; sensorList = mSensorManager.getSensorList(Sensor.TYPE_ALL)</span><span class="s0">;</span><span class="s1"> 
<a name="l112"><span class="ln">112  </span></a>        </span><span class="s3">//setup the adapter for ListView</span><span class="s1"> 
<a name="l113"><span class="ln">113  </span></a>        CustomAdapter adapter = </span><span class="s0">new </span><span class="s1">CustomAdapter(mainContext.getApplicationContext()</span><span class="s0">, </span><span class="s1">R.layout.listitem</span><span class="s0">, </span><span class="s1">sensorList)</span><span class="s0">;</span><span class="s1"> 
<a name="l114"><span class="ln">114  </span></a>        listView.setAdapter(adapter)</span><span class="s0">;</span><span class="s1"> 
<a name="l115"><span class="ln">115  </span></a>        </span><span class="s3">//setup our sensor listener/controller class</span><span class="s1"> 
<a name="l116"><span class="ln">116  </span></a>        sensorController = </span><span class="s0">new </span><span class="s1">SensorController(mainContext</span><span class="s0">, </span><span class="s1">mSensor)</span><span class="s0">;</span><span class="s1"> 
<a name="l117"><span class="ln">117  </span></a>        bluetoothListAdapter = </span><span class="s0">new </span><span class="s1">BluetoothListAdapter(mainContext.getApplicationContext()</span><span class="s0">, </span><span class="s1">R.layout.listitem</span><span class="s0">, </span><span class="s1">bluetoothDeviceList)</span><span class="s0">;</span><span class="s1"> 
<a name="l118"><span class="ln">118  </span></a>        bluetoothView.setAdapter(bluetoothListAdapter)</span><span class="s0">;</span><span class="s1"> 
<a name="l119"><span class="ln">119  </span></a>    }</span><span class="s3">//end updateView()</span><span class="s1"> 
<a name="l120"><span class="ln">120  </span></a> 
</pre><div class="caption">Here is the updateView() method that populates my ListViews to display Bluetooth devices and available sensors.</div>
            </div>
            <div class="smallSpace"></div>
            <div class="codeBox">
                <pre>
<a name="l16"><span class="ln">16   </span></a></span><span class="s0">public class </span><span class="s1">CustomAdapter </span><span class="s0">extends </span><span class="s1">ArrayAdapter&lt;Sensor&gt; { 
<a name="l17"><span class="ln">17   </span></a>    Context adapterContext</span><span class="s0">;</span><span class="s1"> 
<a name="l18"><span class="ln">18   </span></a>    List&lt;Sensor&gt; sensorList</span><span class="s0">;</span><span class="s1"> 
<a name="l19"><span class="ln">19   </span></a>    </span><span class="s0">public </span><span class="s1">CustomAdapter(Context context</span><span class="s0">, int </span><span class="s1">resource) { 
<a name="l20"><span class="ln">20   </span></a>        </span><span class="s0">super</span><span class="s1">(context</span><span class="s0">, </span><span class="s1">resource)</span><span class="s0">;</span><span class="s1"> 
<a name="l21"><span class="ln">21   </span></a>    } 
<a name="l22"><span class="ln">22   </span></a> 
<a name="l23"><span class="ln">23   </span></a>    </span><span class="s3">//constructor for the adapter, pass the List that needs to be organized</span><span class="s1"> 
<a name="l24"><span class="ln">24   </span></a>    </span><span class="s0">public </span><span class="s1">CustomAdapter(Context context</span><span class="s0">, int </span><span class="s1">resource</span><span class="s0">, </span><span class="s1">List objects) { 
<a name="l25"><span class="ln">25   </span></a>        </span><span class="s3">//call out superclass</span><span class="s1"> 
<a name="l26"><span class="ln">26   </span></a>        </span><span class="s0">super</span><span class="s1">(context</span><span class="s0">, </span><span class="s1">resource</span><span class="s0">, </span><span class="s1">objects)</span><span class="s0">;</span><span class="s1"> 
<a name="l27"><span class="ln">27   </span></a>        adapterContext = context</span><span class="s0">;</span><span class="s1"> 
<a name="l28"><span class="ln">28   </span></a>        sensorList = objects</span><span class="s0">;</span><span class="s1"> 
<a name="l29"><span class="ln">29   </span></a>    } 
<a name="l30"><span class="ln">30   </span></a> 
<a name="l31"><span class="ln">31   </span></a>    </span><span class="s3">//method called by ListView object to getView for 'row' of list</span><span class="s1"> 
<a name="l32"><span class="ln">32   </span></a>    @Override 
<a name="l33"><span class="ln">33   </span></a>    </span><span class="s0">public </span><span class="s1">View getView(</span><span class="s0">int </span><span class="s1">posistion</span><span class="s0">, </span><span class="s1">View convertView</span><span class="s0">, </span><span class="s1">ViewGroup parent) { 
<a name="l34"><span class="ln">34   </span></a>        </span><span class="s3">//inflate the 'row' layout</span><span class="s1"> 
<a name="l35"><span class="ln">35   </span></a>        LayoutInflater inflater = (LayoutInflater) adapterContext.getSystemService(Context.LAYOUT_INFLATER_SERVICE)</span><span class="s0">;</span><span class="s1"> 
<a name="l36"><span class="ln">36   </span></a>        </span><span class="s3">//set the 'row' layout</span><span class="s1"> 
<a name="l37"><span class="ln">37   </span></a>        View rowView = inflater.inflate(R.layout.listitem</span><span class="s0">, </span><span class="s1">parent</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l38"><span class="ln">38   </span></a>        </span><span class="s3">//get the TextView of the 'row' layout</span><span class="s1"> 
<a name="l39"><span class="ln">39   </span></a>        TextView textView =  (TextView)rowView.findViewById(R.id.listitemTextView)</span><span class="s0">;</span><span class="s1"> 
<a name="l40"><span class="ln">40   </span></a>        </span><span class="s3">//set what we want displayed in TextView</span><span class="s1"> 
<a name="l41"><span class="ln">41   </span></a>        textView.setText(sensorList.get(posistion).getName())</span><span class="s0">;</span><span class="s1"> 
<a name="l42"><span class="ln">42   </span></a>        </span><span class="s3">//return the 'row' view</span><span class="s1"> 
<a name="l43"><span class="ln">43   </span></a>        </span><span class="s0">return </span><span class="s1">rowView</span><span class="s0">;</span><span class="s1"> 
<a name="l44"><span class="ln">44   </span></a>    } 
<a name="l45"><span class="ln">45   </span></a> 
<a name="l46"><span class="ln">46   </span></a>    </span><span class="s3">//method to return out Sensor object from a 'onClick' event applied to ListView</span><span class="s1"> 
<a name="l47"><span class="ln">47   </span></a>    @Override 
<a name="l48"><span class="ln">48   </span></a>    </span><span class="s0">public </span><span class="s1">Sensor getItem(</span><span class="s0">int </span><span class="s1">position) { 
<a name="l49"><span class="ln">49   </span></a>        </span><span class="s0">return </span><span class="s1">sensorList.get(position)</span><span class="s0">;</span><span class="s1"> 
<a name="l50"><span class="ln">50   </span></a>    } 
<a name="l51"><span class="ln">51   </span></a>} 
</pre>
            </div><div class="smallSpace"></div>
                <div class="codeBox">
                    <pre>
<a name="l17"><span class="ln">17   </span></a></span><span class="s0">public class </span><span class="s1">BluetoothListAdapter </span><span class="s0">extends </span><span class="s1">ArrayAdapter&lt;BluetoothDevice&gt; { 
<a name="l18"><span class="ln">18   </span></a>    </span><span class="s0">private </span><span class="s1">List&lt;BluetoothDevice&gt; devices</span><span class="s0">;</span><span class="s1"> 
<a name="l19"><span class="ln">19   </span></a>    </span><span class="s0">private </span><span class="s1">Context context</span><span class="s0">;</span><span class="s1"> 
<a name="l20"><span class="ln">20   </span></a> 
<a name="l21"><span class="ln">21   </span></a> 
<a name="l22"><span class="ln">22   </span></a>    </span><span class="s0">public </span><span class="s1">BluetoothListAdapter(Context inContext</span><span class="s0">, int </span><span class="s1">resource</span><span class="s0">, </span><span class="s1">List&lt;BluetoothDevice&gt; objects) { 
<a name="l23"><span class="ln">23   </span></a>        </span><span class="s0">super</span><span class="s1">(inContext</span><span class="s0">, </span><span class="s1">resource</span><span class="s0">, </span><span class="s1">objects)</span><span class="s0">;</span><span class="s1"> 
<a name="l24"><span class="ln">24   </span></a>        context = inContext</span><span class="s0">;</span><span class="s1"> 
<a name="l25"><span class="ln">25   </span></a>        devices = objects</span><span class="s0">;</span><span class="s1"> 
<a name="l26"><span class="ln">26   </span></a>    } 
<a name="l27"><span class="ln">27   </span></a> 
<a name="l28"><span class="ln">28   </span></a>    @Override 
<a name="l29"><span class="ln">29   </span></a>    </span><span class="s0">public </span><span class="s1">View getView(</span><span class="s0">int </span><span class="s1">posistion</span><span class="s0">, </span><span class="s1">View convertView</span><span class="s0">, </span><span class="s1">ViewGroup parent) { 
<a name="l30"><span class="ln">30   </span></a>        </span><span class="s3">//inflate the 'row' layout</span><span class="s1"> 
<a name="l31"><span class="ln">31   </span></a>        LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE)</span><span class="s0">;</span><span class="s1"> 
<a name="l32"><span class="ln">32   </span></a>        </span><span class="s3">//set the 'row' layout</span><span class="s1"> 
<a name="l33"><span class="ln">33   </span></a>        View rowView = inflater.inflate(R.layout.listitem</span><span class="s0">, </span><span class="s1">parent</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l34"><span class="ln">34   </span></a>        </span><span class="s3">//get the TextView of the 'row' layout</span><span class="s1"> 
<a name="l35"><span class="ln">35   </span></a>        TextView textView =  (TextView)rowView.findViewById(R.id.listitemTextView)</span><span class="s0">;</span><span class="s1"> 
<a name="l36"><span class="ln">36   </span></a>        </span><span class="s3">//set what we want displayed in TextView</span><span class="s1"> 
<a name="l37"><span class="ln">37   </span></a>        </span><span class="s0">if</span><span class="s1">(devices.size() != </span><span class="s4">0</span><span class="s1">) 
<a name="l38"><span class="ln">38   </span></a>        textView.setText(devices.get(posistion).getName() + </span><span class="s5">&quot;</span><span class="s0">\n</span><span class="s5">&quot; </span><span class="s1">+ devices.get(posistion).getAddress())</span><span class="s0">;</span><span class="s1"> 
<a name="l39"><span class="ln">39   </span></a>        </span><span class="s3">//return the 'row' view</span><span class="s1"> 
<a name="l40"><span class="ln">40   </span></a>        </span><span class="s0">return </span><span class="s1">rowView</span><span class="s0">;</span><span class="s1"> 
<a name="l41"><span class="ln">41   </span></a>    } 
<a name="l42"><span class="ln">42   </span></a> 
<a name="l43"><span class="ln">43   </span></a>    </span><span class="s3">//method to return out Sensor object from a 'onClick' event applied to ListView</span><span class="s1"> 
<a name="l44"><span class="ln">44   </span></a>    @Override 
<a name="l45"><span class="ln">45   </span></a>    </span><span class="s0">public </span><span class="s1">BluetoothDevice getItem(</span><span class="s0">int </span><span class="s1">position) { 
<a name="l46"><span class="ln">46   </span></a>        </span><span class="s0">return </span><span class="s1">devices.get(position)</span><span class="s0">;</span><span class="s1"> 
<a name="l47"><span class="ln">47   </span></a>    } 
<a name="l48"><span class="ln">48   </span></a>} 
</pre>
                </div><div class="caption">Here we see the custom ListAdapter classes that were created to handle populating ListViews with our own objects.</div>
            <div class="space"></div>
            <h2>Sensor Events</h2>
            <p>The sensors are able to be activated once the user clicks on a sensor within the list on the UI. The sensor will then be activated by the app and begin performing
                callbacks with sensor data. The app uses the <a href="http://developer.android.com/reference/android/hardware/SensorManager.html"target="_blank">SensorManager</a>
                 class to control which sensor we are currently accessing. The SensorManager class requires us to register a <a href="http://developer.android.com/reference/android/hardware/SensorEventListener.html"target="_blank">SensorEventListener</a>
                 for handling sensor events. This is accomplished with custom event handlers that implement the SensorEventListener class. </p>
            <div class="codeBox">
                <pre>
<a name="l39"><span class="ln">39   </span></a> 
<a name="l40"><span class="ln">40   </span></a>    @Override 
<a name="l41"><span class="ln">41   </span></a>    </span><span class="s0">public void </span><span class="s1">onSensorChanged(SensorEvent sensorEvent) { 
<a name="l42"><span class="ln">42   </span></a>        coords = sensorEvent.values</span><span class="s0">;</span><span class="s1"> 
<a name="l43"><span class="ln">43   </span></a>        </span><span class="s0">if</span><span class="s1">(sensor.getType() == Sensor.TYPE_ACCELEROMETER) { 
<a name="l44"><span class="ln">44   </span></a>            x = coords[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l45"><span class="ln">45   </span></a>            y = coords[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l46"><span class="ln">46   </span></a>            z = coords[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l47"><span class="ln">47   </span></a>        } 
<a name="l48"><span class="ln">48   </span></a>        </span><span class="s0">else if</span><span class="s1">(sensor.getType() == Sensor.TYPE_ROTATION_VECTOR) { 
<a name="l49"><span class="ln">49   </span></a>            x = coords[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l50"><span class="ln">50   </span></a>            y = coords[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l51"><span class="ln">51   </span></a>            z = coords[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l52"><span class="ln">52   </span></a>            </span><span class="s0">if</span><span class="s1">(coords.length &gt; </span><span class="s3">3</span><span class="s1">) { 
<a name="l53"><span class="ln">53   </span></a>                four = coords[</span><span class="s3">3</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l54"><span class="ln">54   </span></a>                five = coords[</span><span class="s3">4</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l55"><span class="ln">55   </span></a>            } 
<a name="l56"><span class="ln">56   </span></a>        } 
<a name="l57"><span class="ln">57   </span></a>        </span><span class="s0">else if</span><span class="s1">(sensor.getType() == Sensor.TYPE_GRAVITY) { 
<a name="l58"><span class="ln">58   </span></a>            x = coords[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l59"><span class="ln">59   </span></a>            y = coords[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l60"><span class="ln">60   </span></a>            z = coords[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l61"><span class="ln">61   </span></a>        } 
<a name="l62"><span class="ln">62   </span></a>        </span><span class="s0">else if</span><span class="s1">(sensor.getType() == Sensor.TYPE_LINEAR_ACCELERATION) { 
<a name="l63"><span class="ln">63   </span></a>            x = coords[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l64"><span class="ln">64   </span></a>            y = coords[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l65"><span class="ln">65   </span></a>            z = coords[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l66"><span class="ln">66   </span></a>        } 
<a name="l67"><span class="ln">67   </span></a>        </span><span class="s0">else if</span><span class="s1">(sensor.getType() == Sensor.TYPE_LIGHT) { 
<a name="l68"><span class="ln">68   </span></a>            x = coords[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l69"><span class="ln">69   </span></a>        } 
<a name="l70"><span class="ln">70   </span></a>        </span><span class="s0">else if</span><span class="s1">(sensor.getType() == Sensor.TYPE_PROXIMITY) { 
<a name="l71"><span class="ln">71   </span></a>            x = coords[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l72"><span class="ln">72   </span></a>        } 
<a name="l73"><span class="ln">73   </span></a>        run()</span><span class="s0">;</span><span class="s1"> 
<a name="l74"><span class="ln">74   </span></a>    } 
<a name="l75"><span class="ln">75   </span></a> 
</pre><div class="caption">Here is the onSensorChanged() method that must be implemented in our class, the final call to 'run()' sends the gathered data to the views of the main UI. </div>
            </div>
            <div class="space"></div>
            <h2>Bluetooth Communication</h2>
            <p>The app is capable of communication over Bluetooth Classic protocol, though my implementation uses an insecure connection between devices. All of the Bluetooth
                communication is handled with its own class and with thread safety in mind as to not lock the UI during communication or errors while communicating. The class also 
                incorporates error checking in every communication stage, in the case where a sudden disconnection/disabled circumstance takes place.</p>
            <div class="codeBox">
                <pre>
<a name="l22"><span class="ln">22   </span></a></span><span class="s0">public class </span><span class="s1">BluetoothController { 
<a name="l23"><span class="ln">23   </span></a>    </span><span class="s0">private </span><span class="s1">Activity activity</span><span class="s0">;</span><span class="s1"> 
<a name="l24"><span class="ln">24   </span></a>    </span><span class="s0">private </span><span class="s1">BluetoothServerSocket serverSocket</span><span class="s0">;</span><span class="s1"> 
<a name="l25"><span class="ln">25   </span></a>    </span><span class="s0">private </span><span class="s1">BluetoothSocket connectedSocket</span><span class="s0">;</span><span class="s1"> 
<a name="l26"><span class="ln">26   </span></a>    </span><span class="s0">private </span><span class="s1">BluetoothAdapter adapter</span><span class="s0">;</span><span class="s1"> 
<a name="l27"><span class="ln">27   </span></a>    </span><span class="s0">private </span><span class="s1">InputStream inputStream</span><span class="s0">;</span><span class="s1"> 
<a name="l28"><span class="ln">28   </span></a>    </span><span class="s0">private </span><span class="s1">OutputStream outputStream</span><span class="s0">;</span><span class="s1"> 
<a name="l29"><span class="ln">29   </span></a>    </span><span class="s0">private byte</span><span class="s1">[] buffer = </span><span class="s0">new byte</span><span class="s1">[</span><span class="s3">1024</span><span class="s1">]</span><span class="s0">;</span><span class="s1"> 
<a name="l30"><span class="ln">30   </span></a>    </span><span class="s0">private </span><span class="s1">UUID uuid = UUID.fromString(</span><span class="s4">&quot;00001101-0000-1000-8000-00805F9B34FB&quot;</span><span class="s1">)</span><span class="s0">;</span><span class="s1"> 
<a name="l31"><span class="ln">31   </span></a>    </span><span class="s0">public </span><span class="s1">BluetoothController(Activity mainActivity</span><span class="s0">, </span><span class="s1">BluetoothAdapter inAdapter) { 
<a name="l32"><span class="ln">32   </span></a>        adapter = inAdapter</span><span class="s0">;</span><span class="s1"> 
<a name="l33"><span class="ln">33   </span></a>        activity = mainActivity</span><span class="s0">;</span><span class="s1"> 
<a name="l34"><span class="ln">34   </span></a>    } 
<a name="l35"><span class="ln">35   </span></a>    </span><span class="s0">public void </span><span class="s1">disconnect() { 
<a name="l36"><span class="ln">36   </span></a>        </span><span class="s0">try </span><span class="s1">{ 
<a name="l37"><span class="ln">37   </span></a>            connectedSocket.close()</span><span class="s0">;</span><span class="s1"> 
<a name="l38"><span class="ln">38   </span></a>        } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l39"><span class="ln">39   </span></a>            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l40"><span class="ln">40   </span></a>        } 
<a name="l41"><span class="ln">41   </span></a>    } 
<a name="l42"><span class="ln">42   </span></a>    </span><span class="s0">public byte</span><span class="s1">[] read() { 
<a name="l43"><span class="ln">43   </span></a>        </span><span class="s0">try </span><span class="s1">{ 
<a name="l44"><span class="ln">44   </span></a>            inputStream.read(buffer)</span><span class="s0">;</span><span class="s1"> 
<a name="l45"><span class="ln">45   </span></a>        } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l46"><span class="ln">46   </span></a>            </span><span class="s0">try </span><span class="s1">{ 
<a name="l47"><span class="ln">47   </span></a>                connectedSocket.close()</span><span class="s0">;</span><span class="s1"> 
<a name="l48"><span class="ln">48   </span></a>            } </span><span class="s0">catch </span><span class="s1">(IOException e1) { 
<a name="l49"><span class="ln">49   </span></a>                e1.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l50"><span class="ln">50   </span></a>            } 
<a name="l51"><span class="ln">51   </span></a>            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l52"><span class="ln">52   </span></a>        } 
<a name="l53"><span class="ln">53   </span></a>        </span><span class="s0">return </span><span class="s1">buffer</span><span class="s0">;</span><span class="s1"> 
<a name="l54"><span class="ln">54   </span></a>    } 
<a name="l55"><span class="ln">55   </span></a>    </span><span class="s0">public void </span><span class="s1">write(</span><span class="s0">byte</span><span class="s1">[] byteString) { 
<a name="l56"><span class="ln">56   </span></a>        </span><span class="s0">try </span><span class="s1">{ 
<a name="l57"><span class="ln">57   </span></a>            outputStream.write(byteString)</span><span class="s0">;</span><span class="s1"> 
<a name="l58"><span class="ln">58   </span></a>        } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l59"><span class="ln">59   </span></a>            </span><span class="s0">try </span><span class="s1">{ 
<a name="l60"><span class="ln">60   </span></a>                connectedSocket.close()</span><span class="s0">;</span><span class="s1"> 
<a name="l61"><span class="ln">61   </span></a>            } </span><span class="s0">catch </span><span class="s1">(IOException e1) { 
<a name="l62"><span class="ln">62   </span></a>                e1.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l63"><span class="ln">63   </span></a>            } 
<a name="l64"><span class="ln">64   </span></a>            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l65"><span class="ln">65   </span></a>        } 
<a name="l66"><span class="ln">66   </span></a>    } 
<a name="l67"><span class="ln">67   </span></a>    </span><span class="s0">public void </span><span class="s1">write(</span><span class="s0">int </span><span class="s1">inInt) { 
<a name="l68"><span class="ln">68   </span></a>        </span><span class="s0">try </span><span class="s1">{ 
<a name="l69"><span class="ln">69   </span></a>            outputStream.write(inInt)</span><span class="s0">;</span><span class="s1"> 
<a name="l70"><span class="ln">70   </span></a>        } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l71"><span class="ln">71   </span></a>            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l72"><span class="ln">72   </span></a>        } 
<a name="l73"><span class="ln">73   </span></a>    } 
<a name="l74"><span class="ln">74   </span></a> 
<a name="l75"><span class="ln">75   </span></a>    </span><span class="s0">public void </span><span class="s1">discover() { 
<a name="l76"><span class="ln">76   </span></a>        </span><span class="s0">try </span><span class="s1">{ 
<a name="l77"><span class="ln">77   </span></a>            </span><span class="s5">//start listening</span><span class="s1"> 
<a name="l78"><span class="ln">78   </span></a>            serverSocket = adapter.listenUsingInsecureRfcommWithServiceRecord(</span><span class="s4">&quot;BluetoothRC&quot;</span><span class="s0">, </span><span class="s1">uuid)</span><span class="s0">;</span><span class="s1"> 
<a name="l79"><span class="ln">79   </span></a>            </span><span class="s5">//this blocks, so get a new thread</span><span class="s1"> 
<a name="l80"><span class="ln">80   </span></a>            Thread connect = </span><span class="s0">new </span><span class="s1">Thread() { 
<a name="l81"><span class="ln">81   </span></a>                @Override 
<a name="l82"><span class="ln">82   </span></a>                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l83"><span class="ln">83   </span></a>                    </span><span class="s5">//just keep listening until we get exception or are connected</span><span class="s1"> 
<a name="l84"><span class="ln">84   </span></a>                    </span><span class="s0">while</span><span class="s1">(</span><span class="s0">true</span><span class="s1">) { 
<a name="l85"><span class="ln">85   </span></a>                        </span><span class="s0">try </span><span class="s1">{ 
<a name="l86"><span class="ln">86   </span></a>                            </span><span class="s5">//get our socket from the ServerSocket, wait for it....</span><span class="s1"> 
<a name="l87"><span class="ln">87   </span></a>                            connectedSocket = serverSocket.accept()</span><span class="s0">;</span><span class="s1"> 
<a name="l88"><span class="ln">88   </span></a>                        } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l89"><span class="ln">89   </span></a>                            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l90"><span class="ln">90   </span></a>                            activity.runOnUiThread(</span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l91"><span class="ln">91   </span></a>                                @Override 
<a name="l92"><span class="ln">92   </span></a>                                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l93"><span class="ln">93   </span></a>                                    Toast toast = Toast.makeText(activity</span><span class="s0">, </span><span class="s4">&quot;Timeout!&quot;</span><span class="s0">, </span><span class="s1">Toast.LENGTH_SHORT)</span><span class="s0">;</span><span class="s1"> 
<a name="l94"><span class="ln">94   </span></a>                                    toast.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l95"><span class="ln">95   </span></a>                                } 
<a name="l96"><span class="ln">96   </span></a>                            })</span><span class="s0">;</span><span class="s1"> 
<a name="l97"><span class="ln">97   </span></a>                            </span><span class="s0">break;</span><span class="s1"> 
<a name="l98"><span class="ln">98   </span></a>                        } 
<a name="l99"><span class="ln">99   </span></a>                        </span><span class="s0">if </span><span class="s1">(connectedSocket != </span><span class="s0">null</span><span class="s1">) { 
<a name="l100"><span class="ln">100  </span></a>                            </span><span class="s5">//close the server socket</span><span class="s1"> 
<a name="l101"><span class="ln">101  </span></a>                            </span><span class="s0">try </span><span class="s1">{ 
<a name="l102"><span class="ln">102  </span></a>                                serverSocket.close()</span><span class="s0">;</span><span class="s1"> 
<a name="l103"><span class="ln">103  </span></a>                            } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l104"><span class="ln">104  </span></a>                                e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l105"><span class="ln">105  </span></a>                            } 
<a name="l106"><span class="ln">106  </span></a>                            </span><span class="s5">//get our streams from socket</span><span class="s1"> 
<a name="l107"><span class="ln">107  </span></a>                            </span><span class="s0">try </span><span class="s1">{ 
<a name="l108"><span class="ln">108  </span></a>                                inputStream = connectedSocket.getInputStream()</span><span class="s0">;</span><span class="s1"> 
<a name="l109"><span class="ln">109  </span></a>                                outputStream = connectedSocket.getOutputStream()</span><span class="s0">;</span><span class="s1"> 
<a name="l110"><span class="ln">110  </span></a>                            } </span><span class="s0">catch </span><span class="s1">(IOException e) { 
<a name="l111"><span class="ln">111  </span></a>                                e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l112"><span class="ln">112  </span></a>                            } 
<a name="l113"><span class="ln">113  </span></a>                            activity.runOnUiThread(</span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l114"><span class="ln">114  </span></a>                                @Override 
<a name="l115"><span class="ln">115  </span></a>                                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l116"><span class="ln">116  </span></a>                                    MainActivity.addBluetoothDevice(connectedSocket.getRemoteDevice()</span><span class="s0">, </span><span class="s1">connectedSocket)</span><span class="s0">;</span><span class="s1"> 
<a name="l117"><span class="ln">117  </span></a>                                } 
<a name="l118"><span class="ln">118  </span></a>                            })</span><span class="s0">;</span><span class="s1"> 
<a name="l119"><span class="ln">119  </span></a>                            </span><span class="s5">//toast the user success</span><span class="s1"> 
<a name="l120"><span class="ln">120  </span></a>                            activity.runOnUiThread(</span><span class="s0">new </span><span class="s1">Runnable() { 
<a name="l121"><span class="ln">121  </span></a>                                @Override 
<a name="l122"><span class="ln">122  </span></a>                                </span><span class="s0">public void </span><span class="s1">run() { 
<a name="l123"><span class="ln">123  </span></a>                                    Toast toast = Toast.makeText(activity</span><span class="s0">, </span><span class="s4">&quot;Connected!&quot;</span><span class="s0">, </span><span class="s1">Toast.LENGTH_LONG)</span><span class="s0">;</span><span class="s1"> 
<a name="l124"><span class="ln">124  </span></a>                                    toast.show()</span><span class="s0">;</span><span class="s1"> 
<a name="l125"><span class="ln">125  </span></a>                                } 
<a name="l126"><span class="ln">126  </span></a>                            })</span><span class="s0">;</span><span class="s1"> 
<a name="l127"><span class="ln">127  </span></a>                            </span><span class="s5">//get out of the loop</span><span class="s1"> 
<a name="l128"><span class="ln">128  </span></a>                            </span><span class="s0">break;</span><span class="s1"> 
<a name="l129"><span class="ln">129  </span></a>                        } 
<a name="l130"><span class="ln">130  </span></a>                    } 
<a name="l131"><span class="ln">131  </span></a>                } 
<a name="l132"><span class="ln">132  </span></a>            }</span><span class="s0">;</span><span class="s1"> 
<a name="l133"><span class="ln">133  </span></a>            connect.start()</span><span class="s0">;</span><span class="s1"> 
<a name="l134"><span class="ln">134  </span></a>        } 
<a name="l135"><span class="ln">135  </span></a>        </span><span class="s0">catch</span><span class="s1">(IOException e) { 
<a name="l136"><span class="ln">136  </span></a>            e.printStackTrace()</span><span class="s0">;</span><span class="s1"> 
<a name="l137"><span class="ln">137  </span></a>        } 
<a name="l138"><span class="ln">138  </span></a>    } 
<a name="l139"><span class="ln">139  </span></a>} 
<a name="l140"><span class="ln">140  </span></a> 
</pre><div class="caption">Here we see the 'BluetoothController' class. Notice the new Thread and the try/catch blocks to catch any communication errors that may arise.</div>
            </div>
            <div class="smallSpace"></div>
            <h2>Conclusion</h2>
            <p>
                The development of 'Sensor App' taught me quite a few things about the Android system and working with phone hardware. The process taught me how to 
                interact with and incorporate physical sensors on the device; along with the ability to properly display object to the user in an interactive list-style setting. I also
                gained knowledge of the Bluetooth communication protocol as it applies to the Android system; along with the ability to send data over Bluetooth. I now have 
                comfort in creating my own handlers for Android events and Intents which will allow me to incorporate these skills on future developments. 
            </p>


                <h2>Please Check Back for Updates!</h2>
                <p style="text-align:center;"><a href="Source/">Raw Source Files</a></p>
                <div id="footer">
                    <div id="copyright">
                        <p>Copyright &copy; 2015 Dustin Anderson</p>
                    </div>
                    <div id="aboutButton">
                        <p><a href="../index.html">About</a></p>
                    </div>
                </div>
            </div><!--end DashCamDiv-->
        </div>
        <div id="sideBar">
            <ul id="sideBarList">
                <p style="text-align:center; text-decoration:underline;">Projects</p>
                <li class="sideBarItem" id="RingerWrangler"><a href="AndroidRingerWrangler.html">Ringer Wrangler</a></li>
                <li class="sideBarItem" id="DashCam"><a href="AndroidDashCam.html">Dash Cam</a></li>
                <li class="sideBarItem" id="BluetoothRc"><a href="AndroidBTLERC.html">BTLE RC Car</a></li>
                <li class="sideBarItem" id="BluetoothShare" style="color: #006600; cursor:default;">Sensor App</li>
            </ul>
        </div>
        <div id="menuBar">
            <ul id="menuList">
                <li class="menuItem"><a href="../CPP/CPP.html">C++</a></li>
                <li class="menuItem"><a href="../CSHARP/CSharp.html">C#</a></li>
                <li class="menuItem"><a href="../JAVA/Java.html">Java</a></li>
                <li class="menuItem"><a href="../ASM/ASM.html">Embedded Systems</a></li>
                <li class="menuItem" style="color: #80CC80;">Android</li>
            </ul>
        </div>
    </div><!--end container-->
</body>

</html>