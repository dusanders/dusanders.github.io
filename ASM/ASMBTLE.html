<!DOCTYPE html>
<html lang="en-US">
<head>
    <link rel="stylesheet" href="../stylesheet.css">

    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../script.js"></script>
    <title>BTLE RC Car</title>
</head>
<body>
    <div id="background" style="padding-top: 200px; padding-left:100px;"><img src="bg.jpg" /></div>
    <div id="textBackground"></div>
    <div id="container">
        <div class="content-div">
            <h1 style="text-align:center;">Bluetooth Low Energy RC Car</h1>

        <p>This project started as an idea I had for learning Bluetooth technology. Wireless communications are rapidly expanding and gaining more
            demand every year. Bluetooth technology is not going anywhere anytime soon, there is a wide spectrum of applications for Bluetooth; from peer-to-peer 
            messages without the need for cell coverage, to medical devices that require communication to various devices, the applications vary wildy. The main advantage
            of Bluetooth Low Energy is the small amount of power required by the device. These devices draw very little power, yet allow for wireless communication
            between devices. Medical applications, sports and fitness, Internet-of-Things, all of these applications benefit from devices that utilize Bluetooth Low Energy. </p>

        <p>My project makes use of  Texas Instrument's <a href="http://www.ti.com/product/msp430g2553">MSP430G2553</a> microcontroller, along with a
    <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/50002279A.pdf">Microchip RN4020</a> bluetooth low engery module. i also incorporated
    a pulse-width modulation bridge to power the drive motors. the car recieves commands via an android application which uses the smartphone's accelerometer sensor
    as directional input; tilt the phone in the direction you wish to travel, or lay flat for a stopping position. the android application can be reviewed under my <a href="../ANDROID/AndroidBTLERC.html">Android</a> page.
</p>
        <div class="smallSpace"></div>
        <h2>Main Components</h2>
        <p>
            The RN4020 Bluetooth module contains a UART bridge that allows communication using this protocol, which lends itself to easily integrate with low energy, low cost
            microcontrollers. The RN4020 was chosen for this project based on its low cost and simple UART integration, along with the Bluetooth Low Energy technology that I was
            interested in learning about. The module is well documented and having the ability to program the module through UART made development a straight forward ordeal. The 
            module is easily programed using commands sent over the UART protocol, this was accomplished in my project with the use of the MSP430 Launchpad 
            and my Java <a href="../JAVA/SerialComm.html">Serial Communication</a> program. 
        </p>
        <p>
            The MSP430G2553 was chosen based on its low cost, low energy, and excellent documentation. The microcontroller and its Evaluation Kit (Launchpad) are really cheap, around
            ten dollars, comes with two microcontrollers, and is fully supported with TI's own CCS development suite, or IAR's development suite. The microcontroller is able to communicate
            over UART which allows the integration with the RN4020. The microcontroller handles all of the interaction with the Bluetooth module over this protocol and drives the pulse-width 
            modulation that powers the drivetrain. 
        </p>
        <div class="smallSpace"></div>
        <h2>Operation</h2>
        <p>
            The programming of the RN4020 was done with a 'bare' Launchpad and breadboard. The only exception is the first boot after a complete factory restore, as the module ships
            with a UART baud rate of 11500, which is too high for my Java program to handle; therefore, I used the MSP controller to set the module to a more friendly 9600 baud rate which
            then allowed for the programming via Launchpad. Setting the module's various options was straightforward when working with the documentation, I was able to put in my own device
            name, company name, software version number, and bluetooth-friendly name. 
        </p>
        <p>The bulk of the development was spent on the MSP microcontroller and powering the pulse-width modulation for the drivetrain. Having worked with UART protocol during
            my <a href="ASMScroll.html">Scroll Project</a>, it was pretty straight forward setting up communication between the two units.  Once the
            microcontroller is powered on, it powers the Bluetooth module and enters a low energy state waiting for an interrupt from the UART lines.</p>
        <div class="codeBoxN">
            <pre>
                
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">WDTCTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">WDTPW</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">WDTHOLD</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// Stop WDT
</span><span class="sc0">  </span><span class="sc2">//MAKE SURE EVERYTHING IS OFF
</span><span class="sc0">  </span><span class="sc11">P1OUT</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">P1DIR</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">P2OUT</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x00</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">//RESET PROCEDURE FOR FULL SYSTEM RESET
</span><span class="sc0">  </span><span class="sc2">//THIS RESETS ALL SETTINGS IN RN4020
</span><span class="sc1">/*
  P1DIR |= BIT4;    //1.4 OUTPUT FOR SW_WAKE
  P1OUT |= BIT4;    //PUT SW_WAKE HIGH
  P1DIR |= BIT3;    //1.3 TO OUTPUT FOR CMD PIN
  P1OUT |= BIT3;    //PUT 1.3 HIGH FOR SYSTEM RESET
  P1DIR |= BIT6;    //1.6 TO OUTPUT FOR SYSTEM VDD
  P1OUT |= BIT6;    //1.6 ON FOR POWER
*/</span><span class="sc0">
  </span><span class="sc2">//SETUP OUR UART
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">CALBC1_1MHZ</span><span class="sc10">==</span><span class="sc4">0xFF</span><span class="sc10">)</span><span class="sc0">                    </span><span class="sc2">// If calibration constant erased
</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">                               </span><span class="sc2">// do not load, trap CPU!!
</span><span class="sc0">  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">DCOCTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                               </span><span class="sc2">// Select lowest DCOx and MODx settings
</span><span class="sc0">  </span><span class="sc11">P1SEL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BIT1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">BIT2</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">                     </span><span class="sc2">// P1.1 = RXD, P1.2=TXD
</span><span class="sc0">  </span><span class="sc11">P1SEL2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BIT1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">BIT2</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc2">// P1.1 = RXD, P1.2=TXD
</span><span class="sc0">
  </span><span class="sc2">//FOR USE WITH 9600 BAUD UART
</span><span class="sc0">  </span><span class="sc11">BCSCTL1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CALBC1_1MHZ</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">BCSCTL3</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LFXT1S_2</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DCOCTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CALDCO_1MHZ</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">UCA0CTL1</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCSSEL_2</span><span class="sc10">;</span><span class="sc0">                     </span><span class="sc2">// SMCLK
</span><span class="sc0">  </span><span class="sc11">UCA0BR0</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">104</span><span class="sc10">;</span><span class="sc0">                            </span><span class="sc2">//9600
</span><span class="sc0">  </span><span class="sc11">UCA0BR1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc1">/*
  //FOR USE WITH 115200 UART BAUD
 UCA0MCTL = UCBRS0;
 UCA0BR0 = 8;                               //115200
 UCA0BR1 = 0;
 UCA0MCTL = UCBRS2 + UCBRS1;
*/</span><span class="sc0">
  </span><span class="sc11">UCA0CTL1</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">UCSWRST</span><span class="sc10">;</span><span class="sc0">                     </span><span class="sc2">// **Initialize USCI state machine**
</span><span class="sc0">  </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0RXIE</span><span class="sc10">;</span><span class="sc0">                          </span><span class="sc2">// Enable USCI_A0 RX interrupt
</span><span class="sc0">
</span><span class="sc11">__bis_SR_register</span><span class="sc10">(</span><span class="sc11">GIE</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// interrupts enabled
</span><span class="sc0">    </span><span class="sc2">//TURN ON SW_WAKE TO AVOID RESET &lt;--BT Module
</span><span class="sc0">    </span><span class="sc11">P1DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">P1OUT</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//TURN ON DEVICE &lt;--BT Module
</span><span class="sc0">    </span><span class="sc11">P1DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT6</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">P1OUT</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT6</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//SET OUTPUT FOR HW_WAKE &lt;--BT Module
</span><span class="sc0">    </span><span class="sc11">P1DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT7</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">P1OUT</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT7</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">__bis_SR_register</span><span class="sc10">(</span><span class="sc11">LPM0_bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">GIE</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// Enter LPM0, interrupts enabled
</span><span class="sc10">}</span><span class="sc0">
</pre><div class="caption">Here we see the MSP startup procedure.</div>
        </div><div class="smallSpace"></div>
            <p>
                The microcontroller is responsible
                for receiving
                and interpreting the strings that are received by the RN4020 module; the string that are received over Bluetooth LE are 'forwarded' via UART to the MSP unit.
                Each string that the RN4020 received is placed into a buffer and sent over UART one character at time and ending with a '\r\n' escape sequence. The MSP pushes every received
                character into a buffer and always checks received characters against the escape sequence to find the end of the command.  After the escape sequence is found, the MSP sends its received string to a switch block that will
                then set the motors.
            </p>
            <div class="codeBoxN">
                <pre>
                
</span><span class="sc2">//=============================================================================
//=============================ISR ROUTINES====================================
//=============================================================================
</span><span class="sc0">
</span><span class="sc2">// UART RX ISR routine
</span><span class="sc9">#pragma vector=USCIAB0RX_VECTOR
</span><span class="sc11">__interrupt</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">USCI0RX_ISR</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc11">receivePointer</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">UCA0RXBUF</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">UCA0RXBUF</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">receivePointer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//shut up and wait while we get done setting up motors
</span><span class="sc11">__bic_SR_register</span><span class="sc10">(</span><span class="sc11">GIE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//decide what to do
</span><span class="sc0">    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc2">//if we get an 'AOK' --disregard it
</span><span class="sc0">      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'A'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">clearBuffer</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc2">//did we get a 'Connected' or 'Connection End'?
</span><span class="sc0">      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'C'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">connectStatus</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc2">//clear the buffer out
</span><span class="sc0">        </span><span class="sc11">clearBuffer</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc2">//did we get an 'Indicate'?
</span><span class="sc0">      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'I'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">setMotor</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//ok to talk again
</span><span class="sc11">__bis_SR_register</span><span class="sc10">(</span><span class="sc11">GIE</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">// UART TX ISR routine
</span><span class="sc9">#pragma vector = USCIAB0TX_VECTOR
</span><span class="sc11">__interrupt</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">USCI0TX_ISR</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">UCA0TXBUF</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">[</span><span class="sc11">sendPointer</span><span class="sc10">++];</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">[</span><span class="sc11">sendPointer</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">sendPointer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</pre><div class="caption">Here we see the interrupt routines of the MSP microcontroller.</div>
            </div>
        <p>
            The drivetrain of the car is a twin motor gearbox; consisting of two seperate motors controlling one wheel axle per motor. The motors are controlled via a PWM signal that is
            generated using the onboard PWM settings of the MSP unit. The phone will send a dutycycle value of between zero and ten, this value is sent by a few different BTLE characteristics
            that were written in the Android app that controls the car. Each direction has its own characteristic which cooresponds to the repective angle of the phone. An example of this
            would be when the phone is tilted forward; the characteristic representing the 'forward' direction would send the accelerometer reading to the RN4020 which forwards that command
            to the MSP. The microcontroller then 'reads' this command and sets the correct motor signals.
        </p>
        <div class="codeBoxN">
            <pre>                
</span><span class="sc2">//get our direction and duty cycle, set motors
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">setMotor</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">12</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'A'</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">forward</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'A'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">forward</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'E'</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'E'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">left</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'C'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">backwards</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'C'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">backwards</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">right</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">right</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
 </span><span class="sc10">}</span><span class="sc0">
</pre><div class="caption">Here we see the routine that checks the received string against constant strings to interpret what direction to move.</div>
        </div>
        <p>Finally, the motors are setup with the MSP's PWM settings. A problem I faced here was what to do with the drive wheels in the event that the car is currently moving
            in some direction. If I left static procedures that only performed one specific actions, the car would not move as one would expect. I found that the communication 
            between the phone and the car was such at such a speed that the car would take an 'average' of the inputs and merely slow down versus actually turning.</p>
        <div class="codeBoxN">
            <pre>                
</span><span class="sc2">//set PWM cycles
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">direction</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'A'</span><span class="sc10">:</span><span class="sc0">             </span><span class="sc2">//forward
</span><span class="sc0">        </span><span class="sc2">//pin 2.2 set to TA1
</span><span class="sc0">         </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">// are we moving?
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">dutyCycle</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">//are we turning?
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">//set TA1 CCR0 to 100Hz
</span><span class="sc0">        </span><span class="sc11">TA1CCR0</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">10000</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//get our duty cycle value (passed values are 1 - 9)
</span><span class="sc0">        </span><span class="sc11">TA1CCR1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">//2.1
</span><span class="sc0">        </span><span class="sc11">TA1CCTL1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">TA1CCR2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">//2.4
</span><span class="sc0">        </span><span class="sc11">TA1CCTL2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">TA1CTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TASSEL_2</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MC_1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">TACLR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'E'</span><span class="sc10">:</span><span class="sc0">             </span><span class="sc2">//left
</span><span class="sc0">        </span><span class="sc2">//pin 2.1
</span><span class="sc0">        </span><span class="sc2">//let everyone know we are turning
</span><span class="sc0">        </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">dutyCycle</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">//are we currently moving?
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">//are we stopped?
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCR0</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">10000</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCR1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">//2.2
</span><span class="sc0">          </span><span class="sc11">TA1CCTL1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCR2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">//2.4
</span><span class="sc0">          </span><span class="sc11">TA1CCTL2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TASSEL_2</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc11">MC_1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">TACLR</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'C'</span><span class="sc10">:</span><span class="sc0">             </span><span class="sc2">//backwards
</span><span class="sc0">        </span><span class="sc2">//pin 2.4 set to TA1.2
</span><span class="sc0">          </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">dutyCycle</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">//set TA1 CCR to 100Hz
</span><span class="sc0">        </span><span class="sc11">TA1CCR0</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">10000</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//set our duty cycle
</span><span class="sc0">        </span><span class="sc11">TA1CCR1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">//2.1
</span><span class="sc0">        </span><span class="sc11">TA1CCTL1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">TA1CCR2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">//2.5
</span><span class="sc0">        </span><span class="sc11">TA1CCTL2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">TA1CTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TASSEL_2</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MC_1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">TACLR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">:</span><span class="sc0">             </span><span class="sc2">//right
</span><span class="sc0">        </span><span class="sc2">//pin 2.5 TA1.2
</span><span class="sc0">        </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">dutyCycle</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingRight</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">movingLeft</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">moving</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT5</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">BIT1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2DIR</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">P2SEL</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">BIT4</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCR0</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">10000</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCR1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCTL1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCR2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dutyCycle</span><span class="sc10">*</span><span class="sc4">1000</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CCTL2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OUTMOD_7</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">TA1CTL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TASSEL_2</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc11">MC_1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">TACLR</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//check our connection status
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">connectStatus</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">match</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">//examine received string
</span><span class="sc0">  </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'\r'</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">stateOn</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">match</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">match</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc2">//connected - send command to start sensor
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">match</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//get our direction and duty cycle, set motors
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">setMotor</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">12</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'A'</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">forward</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'A'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">forward</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'E'</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'E'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">left</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'C'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">backwards</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'C'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">backwards</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">right</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">14</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc4">10</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">[</span><span class="sc4">15</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">direction</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">setTimer</span><span class="sc10">(</span><span class="sc11">right</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc2">//send the ack
</span><span class="sc0">        </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"chw,0032,0001\r"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IE2</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">UCA0TXIE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
 </span><span class="sc10">}</span><span class="sc0">
</pre><div class="caption">Here we see the procedure that sets the PWM of the drivetrain. Note the conditions we check to determine whether we are currently moving or not.</div>
        </div>
        <div class="smallSpace"></div>
        <h2>Conclusion</h2>
        <p>The project was a great learning experience, having never worked with Bluetooth Low Energy or pulse width modulation, it was interesting and fun to figure out each 
            protocol. The Bluetooth Low Energy was interesting as I imagined BTLE would allow for data 'streams' but it only allows for small chucks of data to be written, more like
            small updates than data streams. The pulse width modulation was great to work with, the protocol is used extensively throughout microcontroller projects and embedded 
            applications. Learning these two protocols makes me interested in possibly building my own quadcopter at some point, but we will see.</p>
            <h2>Please Check Back for Updates!</h2>
            <p style="text-align:center;"><a href="https://github.com/dusanders/dusanders.github.io/tree/master/ASM/Source"target="_blank">Raw Source Files</a></p>
            <div id="footer">
                <div id="copyright">
                    <p>Copyright &copy; 2015 Dustin Anderson</p>
                </div>
                <div id="aboutButton">
                    <p><a href="../index.html">About</a></p>
                </div>
            </div>
        </div><!--End content-div-->
        <div id="sideBar">
            <ul id="sideBarList">
                <p style="text-align:center; text-decoration:underline;">Projects</p>
                <li class="sideBarItem" id="ScrollProject"><a href="ASMScroll.html">Scroll Project</a></li>
                <li class="sideBarItem" id="BluetoothRc" style="color: #006600; cursor:default;">BTLE RC Car</li>
            </ul>
        </div>
        <div id="menuBar">
            <ul id="menuList">
                <li class="menuItem"><a href="../CPP/CPP.html">C++</a></li>
                <li class="menuItem"><a href="../CSHARP/CSharp.html">C#</a></li>
                <li class="menuItem"><a href="../JAVA/Java.html">Java</a></li>
                <li class="menuItem" style="color: #80CC80;">Embedded Systems</li>
                <li class="menuItem"><a href="../ANDROID/AndroidHome.html">Android</a></li>
            </ul>
        </div>
    </div><!--end container-->
</body>